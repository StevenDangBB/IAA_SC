import{r as b,j as e,R as ee}from"./vendor-react--UE8qFvL.js";import{u as te,d as se,T as ae,c as re,I as h,e as U}from"./index-BfjZgsUE.js";import"./vendor-BhE6lIor.js";import"./vendor-genai-C0GBL7S7.js";const L=i=>{let m=[i.id];return i.subClauses&&i.subClauses.forEach(c=>{m=[...m,...L(c)]}),m},le=b.memo(({clause:i,level:m,processes:c,isExpanded:N,onToggleDescription:C,onCopyCitation:v,onSmartToggle:f})=>{const S=b.useMemo(()=>L(i),[i]),j=i.subClauses&&i.subClauses.length>0;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-800/30 transition-colors group duration-300 ease-fluid",children:[e.jsx("td",{className:"p-2 border-r border-gray-100 dark:border-slate-800 sticky left-0 bg-white dark:bg-slate-900 group-hover:bg-gray-50 dark:group-hover:bg-slate-800/30 z-10 align-top transition-colors duration-300 ease-fluid",children:e.jsxs("div",{className:`flex flex-col gap-1 ${m>0?"ml-4 border-l-2 border-gray-200 dark:border-slate-800 pl-2":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-bold whitespace-nowrap ${m===0?"bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700":"text-slate-400"}`,children:i.code}),e.jsx("span",{className:`text-xs truncate ${m===0?"font-bold text-slate-800 dark:text-slate-200":"font-medium text-slate-600 dark:text-slate-400"}`,children:i.title})]}),m===0&&e.jsxs("div",{className:"relative group/desc pr-4",children:[e.jsx("div",{onClick:()=>C(i.id),className:`text-[10px] text-slate-500 dark:text-slate-400 mt-1 cursor-pointer hover:text-slate-800 dark:hover:text-slate-200 transition-colors font-serif italic text-left whitespace-pre-wrap leading-relaxed ${N?"":"line-clamp-3"}`,title:"Click to toggle full text",children:i.description}),e.jsx("button",{onClick:k=>{k.stopPropagation(),v(i.description)},className:"absolute top-0 right-0 opacity-0 group-hover/desc:opacity-100 transition-opacity p-1 text-slate-400 hover:text-indigo-600 bg-white/80 dark:bg-slate-900/80 rounded",title:"Copy Citation",children:e.jsx(h,{name:"Copy",size:12})})]})]})}),c.map(k=>{let u="none";if(j){const w=S.reduce((E,$)=>E+(k.matrixData[$]?1:0),0);w===S.length?u="all":w>0&&(u="some")}else u=k.matrixData[i.id]?"all":"none";return e.jsx("td",{className:"p-1 text-center border-r border-gray-50 dark:border-slate-800/50 last:border-0 relative align-middle",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:()=>f(k.id,i),className:`w-8 h-8 rounded-lg flex items-center justify-center transition-all duration-300 ease-spring ${u==="all"?"bg-emerald-500 text-white shadow-sm shadow-emerald-500/40 transform scale-105":u==="some"?"bg-orange-100 dark:bg-orange-900/30 text-orange-500 border border-orange-200 dark:border-orange-800":"bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-300"}`,title:u==="all"?"Fully Planned":u==="some"?"Partially Planned (Click to Fill)":"Click to Plan",children:[u==="all"&&(j?e.jsx(h,{name:"CheckCircle2",size:14}):e.jsx(h,{name:"CheckThick",size:14})),u==="some"&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-orange-500"})]})})},`${k.id}_${i.id}`)})]})},(i,m)=>i.isExpanded!==m.isExpanded||i.processes.length!==m.processes.length?!1:!i.processes.some((N,C)=>{const v=m.processes[C];return N.matrixData!==v.matrixData})),ce=()=>{const{standards:i,standardKey:m,processes:c,addProcess:N,batchUpdateProcessClauses:C,toggleProcessClause:v}=te(),{showToast:f,setSidebarOpen:S}=se(),[j,k]=b.useState(""),[u,w]=b.useState("en"),E=b.useRef(null),$=b.useRef(null),[T,P]=b.useState(new Set),[G,F]=b.useState(new Set),d=i[m],g=ae.find(t=>t.id==="planning"),I=t=>{const s=t.toUpperCase();return s.includes("PLAN")?"bg-orange-50 hover:bg-orange-100 dark:bg-orange-900/20 dark:hover:bg-orange-900/30 text-orange-700 dark:text-orange-400 border-l-4 border-orange-500":s.includes("SUPPORT")?"bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 text-blue-700 dark:text-blue-400 border-l-4 border-blue-500":s.includes("DO")?"bg-cyan-50 hover:bg-cyan-100 dark:bg-cyan-900/20 dark:hover:bg-cyan-900/30 text-cyan-700 dark:text-cyan-400 border-l-4 border-cyan-500":s.includes("CHECK")||s.includes("ACT")?"bg-emerald-50 hover:bg-emerald-100 dark:bg-emerald-900/20 dark:hover:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 border-l-4 border-emerald-500":s.includes("ANNEX")?"bg-purple-50 hover:bg-purple-100 dark:bg-purple-900/20 dark:hover:bg-purple-900/30 text-purple-700 dark:text-purple-400 border-l-4 border-purple-500":`${g.bgSoft} border-l-4 ${g.borderClass} ${g.textClass}`},M=b.useMemo(()=>t=>{const s=[],a=(l,o)=>{l.forEach(n=>{s.push({clause:n,level:o}),n.subClauses&&a(n.subClauses,o+1)})};return a(t,0),s},[]),_=b.useCallback((t,s)=>{const a=c.find(n=>n.id===t);if(!a)return;const l=L(s);if(!(l.length>1))v(t,s.id);else if(l.reduce((r,p)=>r+(a.matrixData[p]?1:0),0)===l.length)l.forEach(r=>{a.matrixData[r]&&v(t,r)});else{const r=l.filter(p=>!a.matrixData[p]);r.length>0&&C([{processId:t,clauses:r}])}},[c,v,C]),B=(t,s,a)=>{t.stopPropagation();const l=[],o=r=>r.forEach(p=>{l.push(p.id),p.subClauses&&o(p.subClauses)});o(a);const n=c.find(r=>r.id===s);if(!n)return;if(l.every(r=>!!n.matrixData[r]))l.forEach(r=>{n.matrixData[r]&&v(s,r)});else{const r=l.filter(p=>!n.matrixData[p]);C([{processId:s,clauses:r}])}},X=t=>{P(s=>{const a=new Set(s);return a.has(t)?a.delete(t):a.add(t),a})},H=b.useCallback(t=>{F(s=>{const a=new Set(s);return a.has(t)?a.delete(t):a.add(t),a})},[]),J=b.useCallback(t=>{re(t),f("Citation copied!")},[f]),O=b.useMemo(()=>d?d.groups.every(t=>T.has(t.id)):!1,[d,T]),K=()=>{if(!d)return;const t=d.groups.map(s=>s.id);P(O?new Set:new Set(t))},D=b.useMemo(()=>{if(!d)return{percent:0,covered:0,total:0};let t=0;const s=l=>l.forEach(o=>{t++,o.subClauses&&s(o.subClauses)});if(d.groups.forEach(l=>s(l.clauses)),t===0)return{percent:0,covered:0,total:0};const a=new Set;return c.forEach(l=>{Object.keys(l.matrixData).forEach(o=>a.add(o))}),{percent:Math.round(a.size/t*100),covered:a.size,total:t}},[d,c]),A=24,z=2*Math.PI*A,V=z-D.percent/100*z,q=b.useMemo(()=>{if(!d)return[];if(!j)return d.groups;const t=j.toLowerCase();return d.groups.map(s=>{const a=s.clauses.filter(l=>{var x;const o=l.code.toLowerCase().includes(t)||l.title.toLowerCase().includes(t),n=(x=l.subClauses)==null?void 0:x.some(r=>r.code.toLowerCase().includes(t)||r.title.toLowerCase().includes(t));return o||n});return a.length>0?{...s,clauses:a}:null}).filter(s=>s!==null)},[d,j]),W=()=>{if(c.length===0){f("No processes to export.");return}const t=c.map(l=>({name:l.name,clauses:Object.keys(l.matrixData)})),s=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(s),a.download=`${U(d.name)}_Plan.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),f("JSON Template exported.")},Y=()=>{if(c.length===0){f("No data to export.");return}const t={},s=n=>n.forEach(x=>{t[x.id]=x.code,x.subClauses&&s(x.subClauses)});d==null||d.groups.forEach(n=>s(n.clauses));let a="";u==="vi"?a+=`NGÀY XUẤT: ${new Date().toLocaleDateString("vi-VN")}
TIÊU CHUẨN: ${d.name}
====================

`:a+=`EXPORT DATE: ${new Date().toLocaleDateString()}
STANDARD: ${d.name}
====================

`,c.forEach(n=>{const x=Object.keys(n.matrixData).map(r=>t[r]||r).sort((r,p)=>r.localeCompare(p,void 0,{numeric:!0,sensitivity:"base"}));x.length>0&&(a+=`${u==="vi"?"QUY TRÌNH":"PROCESS"}: ${n.name}
`,a+=`${u==="vi"?"ĐIỀU KHOẢN":"SCOPE"}: [${x.join(", ")}]

`)});const l=new Blob([a],{type:"text/plain"}),o=document.createElement("a");o.href=URL.createObjectURL(l),o.download=`${U(d.name)}_Scope_${u}.txt`,document.body.appendChild(o),o.click(),document.body.removeChild(o),f(`TXT Scope exported (${u.toUpperCase()}).`)},Q=t=>{var l;const s=(l=t.target.files)==null?void 0:l[0];if(!s)return;const a=new FileReader;a.onload=o=>{var n;try{const x=(n=o.target)==null?void 0:n.result,r=JSON.parse(x);if(!Array.isArray(r))throw new Error("Invalid format");r.forEach(p=>{p.name&&N(p.name)}),f(`Imported ${r.length} processes structure.`)}catch{f("Import failed.")}},a.readAsText(s),t.target.value=""},Z=()=>{S(!0),setTimeout(()=>{const t=document.getElementById("sidebar-standard-select");if(t){t.focus();try{"showPicker"in t?t.showPicker():t.click()}catch{}}},300)};return d?e.jsxs("div",{className:"h-full flex flex-col animate-fade-in-up gap-4 relative",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-2xl border border-gray-100 dark:border-slate-800 shadow-sm flex flex-col md:flex-row gap-4 items-center justify-between shrink-0 transition-colors duration-500 ease-fluid",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative w-16 h-16 flex items-center justify-center shrink-0",children:[e.jsxs("svg",{className:"transform -rotate-90 w-16 h-16",children:[e.jsx("circle",{cx:"32",cy:"32",r:A,stroke:"currentColor",strokeWidth:"6",fill:"transparent",className:"text-gray-100 dark:text-slate-800"}),e.jsx("circle",{cx:"32",cy:"32",r:A,stroke:"currentColor",strokeWidth:"6",fill:"transparent",strokeDasharray:z,strokeDashoffset:V,className:`${g.textClass.replace("text-","text-opacity-80 ")} transition-all duration-1000 ease-out`,strokeLinecap:"round"})]}),e.jsxs("span",{className:"absolute text-xs font-black text-slate-700 dark:text-white",children:[D.percent,"%"]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:d.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[e.jsx("span",{className:`font-bold ${g.textClass}`,children:D.covered})," of ",D.total," clauses mapped."]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64 group",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-indigo-500 transition-colors",children:e.jsx(h,{name:"Search",size:16})}),e.jsx("input",{ref:$,className:"w-full pl-10 pr-8 py-2.5 bg-white dark:bg-slate-950 border border-indigo-100 dark:border-slate-700 rounded-xl text-sm font-bold text-slate-800 dark:text-slate-200 placeholder-slate-400 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/10 transition-all shadow-sm",placeholder:"Filter clauses...",value:j,onChange:t=>k(t.target.value)}),j&&e.jsx("button",{onClick:()=>{var t;k(""),(t=$.current)==null||t.focus()},className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 text-slate-400 hover:text-red-500 transition-colors",children:e.jsx(h,{name:"X",size:14})})]}),e.jsx("input",{type:"file",ref:E,className:"hidden",accept:".json",onChange:Q}),e.jsx("button",{onClick:()=>{var t;return(t=E.current)==null?void 0:t.click()},className:"p-2.5 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-xl text-slate-600 dark:text-slate-300 shadow-sm active:scale-95 transition-all hover:border-indigo-300 dark:hover:border-slate-600",title:"Import Plan",children:e.jsx(h,{name:"UploadCloud",size:18})}),e.jsxs("button",{onClick:W,className:"p-2.5 px-4 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-xl text-slate-600 dark:text-slate-300 shadow-sm active:scale-95 transition-all hover:border-indigo-300 dark:hover:border-slate-600 flex items-center gap-2",title:"Export Template (JSON)",children:[e.jsx(h,{name:"Grid",size:18}),e.jsx("span",{className:"text-xs font-bold hidden md:inline",children:"Template"})]})]})]}),e.jsx("div",{className:`flex-1 bg-white dark:bg-slate-900 rounded-2xl border ${g.borderClass.replace("border-","border-opacity-30 border-")} border-t-4 border-t-${g.borderClass.replace("border-","")} dark:border-slate-800 overflow-hidden shadow-sm relative flex flex-col transition-colors duration-500 ease-fluid`,children:c.length===0?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-400",children:[e.jsx("p",{className:"mb-4",children:"No processes defined."}),e.jsx("div",{className:"p-4 border-2 border-dashed border-indigo-200 dark:border-indigo-900/50 rounded-xl bg-indigo-50 dark:bg-indigo-900/10 text-indigo-500",children:"Create processes in the sidebar to begin planning."})]}):e.jsx("div",{className:"flex-1 overflow-auto custom-scrollbar relative",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:`${g.bgSoft.replace("50","50/80")} dark:bg-slate-950 sticky top-0 z-30 shadow-sm backdrop-blur-sm transition-colors duration-500 ease-fluid`,children:e.jsxs("tr",{children:[e.jsx("th",{className:`p-3 border-b border-r border-gray-200 dark:border-slate-800 sticky left-0 z-40 min-w-[300px] cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors group select-none ${g.bgSoft}`,onClick:K,title:O?"Click to Expand All":"Click to Collapse All",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider transition-colors ${g.textClass}`,children:"Clause Reference"})})}),c.map(t=>e.jsx("th",{className:`p-3 text-[10px] font-bold uppercase tracking-wider border-b border-gray-200 dark:border-slate-800 min-w-[120px] text-center ${g.textClass}`,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"truncate max-w-[100px]",title:t.name,children:t.name}),e.jsx("span",{className:"text-[10px] font-bold bg-white dark:bg-slate-800 px-2 py-0.5 rounded-full shadow-sm",children:Object.keys(t.matrixData).length})]})},t.id))]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-slate-800/50",children:q.map(t=>{const s=T.has(t.id),a=I(t.id),l=M(t.clauses);return e.jsxs(ee.Fragment,{children:[e.jsxs("tr",{className:`sticky z-20 hover:brightness-95 transition-all duration-500 ease-fluid ${a}`,children:[e.jsx("td",{className:"p-2 border-r border-black/5 dark:border-white/5 font-black text-xs uppercase tracking-widest sticky left-0 z-20 bg-inherit shadow-sm cursor-pointer",onClick:()=>X(t.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{name:t.icon,size:14,className:"opacity-70"}),t.title]}),e.jsx(h,{name:"ChevronDown",size:14,className:`transition-transform duration-300 ${s?"-rotate-90":"rotate-0"}`})]})}),c.map(o=>{const n=[],x=y=>y.forEach(R=>{n.push(R.id),R.subClauses&&x(R.subClauses)});x(t.clauses);const r=c.find(y=>y.id===o.id),p=r?n.every(y=>!!r.matrixData[y]):!1;return e.jsx("td",{className:"p-2 text-center bg-inherit",children:!s&&e.jsx("button",{onClick:y=>B(y,o.id,t.clauses),className:"p-1.5 rounded-lg hover:bg-black/10 dark:hover:bg-white/10 transition-colors opacity-70 hover:opacity-100",title:p?"Deselect Group":"Select Entire Group",children:e.jsx(h,{name:p?"CheckSquare":"Square",size:16})})},`group_action_${o.id}_${t.id}`)})]}),!s&&l.map(({clause:o,level:n})=>e.jsx(le,{clause:o,level:n,processes:c,isExpanded:G.has(o.id),onToggleDescription:H,onCopyCitation:J,onSmartToggle:_},o.id))]},t.id)})})]})})}),e.jsxs("div",{className:"flex-shrink-0 flex flex-row items-center md:justify-end gap-2 md:gap-3 w-full pt-2",children:[e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:Y,disabled:c.length===0,className:"flex-none md:w-auto px-3 md:px-4 h-[52px] bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 hover:border-indigo-500 text-slate-700 dark:text-slate-200 rounded-xl text-xs font-bold flex items-center justify-center gap-2 transition-all duration-300 active:scale-95 shadow-sm disabled:opacity-50 whitespace-nowrap dark:shadow-md",children:[e.jsx(h,{name:"FileText"}),e.jsx("span",{className:"hidden md:inline",children:"Export"}),e.jsxs("div",{className:"lang-pill-container",children:[e.jsx("span",{onClick:t=>{t.stopPropagation(),w("en")},className:`lang-pill-btn ${u==="en"?"lang-pill-active":"lang-pill-inactive"}`,children:"EN"}),e.jsx("span",{onClick:t=>{t.stopPropagation(),w("vi")},className:`lang-pill-btn ${u==="vi"?"lang-pill-active":"lang-pill-inactive"}`,children:"VI"})]})]})]})]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400 bg-gray-50/30 dark:bg-slate-900/30 rounded-2xl border border-dashed border-gray-200 dark:border-slate-800 m-4 animate-fade-in-up",children:[e.jsx(h,{name:"Book",size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-slate-500",children:"No Standard Selected"}),e.jsxs("button",{onClick:Z,className:"mt-6 px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow-lg text-xs font-bold flex items-center gap-2",children:[e.jsx(h,{name:"LayoutList",size:16})," Select Standard"]})]})};export{ce as PlanningView};
