import{r as b,j as e,R as W}from"./vendor-react--UE8qFvL.js";import{u as Y,d as Q,T as Z,I as h,h as U}from"./index-ChNvHOng.js";import"./vendor-BhE6lIor.js";import"./vendor-genai-C0GBL7S7.js";const A=c=>{let m=[c.id];return c.subClauses&&c.subClauses.forEach(d=>{m=[...m,...A(d)]}),m},ee=b.memo(({clause:c,level:m,processes:d,onSmartToggle:N})=>{const j=b.useMemo(()=>A(c),[c]),k=c.subClauses&&c.subClauses.length>0;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-800/30 transition-colors group duration-300 ease-fluid",children:[e.jsx("td",{className:"p-2 border-r border-gray-100 dark:border-slate-800 sticky left-0 bg-white dark:bg-slate-900 group-hover:bg-gray-50 dark:group-hover:bg-slate-800/30 z-10 align-top transition-colors duration-300 ease-fluid",children:e.jsx("div",{className:`flex flex-col gap-1 ${m>0?"ml-4 border-l-2 border-gray-200 dark:border-slate-800 pl-2":""}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-bold whitespace-nowrap ${m===0?"bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700":"text-slate-400"}`,children:c.code}),e.jsx("span",{className:`text-xs truncate ${m===0?"font-bold text-slate-800 dark:text-slate-200":"font-medium text-slate-600 dark:text-slate-400"}`,children:c.title})]})})}),d.map(p=>{let g="none";if(k){const C=j.reduce((w,v)=>w+(p.matrixData[v]?1:0),0);C===j.length?g="all":C>0&&(g="some")}else g=p.matrixData[c.id]?"all":"none";return e.jsx("td",{className:"p-1 text-center border-r border-gray-50 dark:border-slate-800/50 last:border-0 relative align-middle",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:()=>N(p.id,c),className:`w-8 h-8 rounded-lg flex items-center justify-center transition-all duration-300 ease-spring ${g==="all"?"bg-emerald-500 text-white shadow-sm shadow-emerald-500/40 transform scale-105":g==="some"?"bg-orange-100 dark:bg-orange-900/30 text-orange-500 border border-orange-200 dark:border-orange-800":"bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-300"}`,title:g==="all"?"Fully Planned":g==="some"?"Partially Planned (Click to Fill)":"Click to Plan",children:[g==="all"&&(k?e.jsx(h,{name:"CheckCircle2",size:14}):e.jsx(h,{name:"CheckThick",size:14})),g==="some"&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-orange-500"})]})})},`${p.id}_${c.id}`)})]})},(c,m)=>c.processes.length!==m.processes.length?!1:!c.processes.some((N,j)=>{const k=m.processes[j];return N.matrixData!==k.matrixData})),le=()=>{const{standards:c,standardKey:m,processes:d,addProcess:N,batchUpdateProcessClauses:j,toggleProcessClause:k}=Y(),{showToast:p,setSidebarOpen:g}=Q(),[C,w]=b.useState(""),[v,R]=b.useState("en"),z=b.useRef(null),L=b.useRef(null),[$,E]=b.useState(new Set),i=c[m],f=Z.find(t=>t.id==="planning"),G=t=>{const s=t.toUpperCase();return s.includes("PLAN")?"bg-orange-50 hover:bg-orange-100 dark:bg-orange-900/20 dark:hover:bg-orange-900/30 text-orange-700 dark:text-orange-400 border-l-4 border-orange-500":s.includes("SUPPORT")?"bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 text-blue-700 dark:text-blue-400 border-l-4 border-blue-500":s.includes("DO")?"bg-cyan-50 hover:bg-cyan-100 dark:bg-cyan-900/20 dark:hover:bg-cyan-900/30 text-cyan-700 dark:text-cyan-400 border-l-4 border-cyan-500":s.includes("CHECK")||s.includes("ACT")?"bg-emerald-50 hover:bg-emerald-100 dark:bg-emerald-900/20 dark:hover:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 border-l-4 border-emerald-500":s.includes("ANNEX")?"bg-purple-50 hover:bg-purple-100 dark:bg-purple-900/20 dark:hover:bg-purple-900/30 text-purple-700 dark:text-purple-400 border-l-4 border-purple-500":`${f.bgSoft} border-l-4 ${f.borderClass} ${f.textClass}`},I=b.useMemo(()=>t=>{const s=[],a=(l,o)=>{l.forEach(n=>{s.push({clause:n,level:o}),n.subClauses&&a(n.subClauses,o+1)})};return a(t,0),s},[]),F=b.useCallback((t,s)=>{const a=d.find(n=>n.id===t);if(!a)return;const l=A(s);if(!(l.length>1))k(t,s.id);else if(l.reduce((r,x)=>r+(a.matrixData[x]?1:0),0)===l.length)l.forEach(r=>{a.matrixData[r]&&k(t,r)});else{const r=l.filter(x=>!a.matrixData[x]);r.length>0&&j([{processId:t,clauses:r}])}},[d,k,j]),M=(t,s,a)=>{t.stopPropagation();const l=[],o=r=>r.forEach(x=>{l.push(x.id),x.subClauses&&o(x.subClauses)});o(a);const n=d.find(r=>r.id===s);if(!n)return;if(l.every(r=>!!n.matrixData[r]))l.forEach(r=>{n.matrixData[r]&&k(s,r)});else{const r=l.filter(x=>!n.matrixData[x]);j([{processId:s,clauses:r}])}},_=t=>{E(s=>{const a=new Set(s);return a.has(t)?a.delete(t):a.add(t),a})},O=b.useMemo(()=>i?i.groups.every(t=>$.has(t.id)):!1,[i,$]),B=()=>{if(!i)return;const t=i.groups.map(s=>s.id);E(O?new Set:new Set(t))},S=b.useMemo(()=>{if(!i)return{percent:0,covered:0,total:0};let t=0;const s=l=>l.forEach(o=>{t++,o.subClauses&&s(o.subClauses)});if(i.groups.forEach(l=>s(l.clauses)),t===0)return{percent:0,covered:0,total:0};const a=new Set;return d.forEach(l=>{Object.keys(l.matrixData).forEach(o=>a.add(o))}),{percent:Math.round(a.size/t*100),covered:a.size,total:t}},[i,d]),D=24,T=2*Math.PI*D,X=T-S.percent/100*T,H=b.useMemo(()=>{if(!i)return[];if(!C)return i.groups;const t=C.toLowerCase();return i.groups.map(s=>{const a=s.clauses.filter(l=>{var u;const o=l.code.toLowerCase().includes(t)||l.title.toLowerCase().includes(t),n=(u=l.subClauses)==null?void 0:u.some(r=>r.code.toLowerCase().includes(t)||r.title.toLowerCase().includes(t));return o||n});return a.length>0?{...s,clauses:a}:null}).filter(s=>s!==null)},[i,C]),J=()=>{if(d.length===0){p("No processes to export.");return}const t=d.map(l=>({name:l.name,clauses:Object.keys(l.matrixData)})),s=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(s),a.download=`${U(i.name)}_Plan.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),p("JSON Template exported.")},K=()=>{if(d.length===0){p("No data to export.");return}const t={},s=n=>n.forEach(u=>{t[u.id]=u.code,u.subClauses&&s(u.subClauses)});i==null||i.groups.forEach(n=>s(n.clauses));let a="";v==="vi"?a+=`NGÀY XUẤT: ${new Date().toLocaleDateString("vi-VN")}
TIÊU CHUẨN: ${i.name}
====================

`:a+=`EXPORT DATE: ${new Date().toLocaleDateString()}
STANDARD: ${i.name}
====================

`,d.forEach(n=>{const u=Object.keys(n.matrixData).map(r=>t[r]||r).sort((r,x)=>r.localeCompare(x,void 0,{numeric:!0,sensitivity:"base"}));u.length>0&&(a+=`${v==="vi"?"QUY TRÌNH":"PROCESS"}: ${n.name}
`,a+=`${v==="vi"?"ĐIỀU KHOẢN":"SCOPE"}: [${u.join(", ")}]

`)});const l=new Blob([a],{type:"text/plain"}),o=document.createElement("a");o.href=URL.createObjectURL(l),o.download=`${U(i.name)}_Scope_${v}.txt`,document.body.appendChild(o),o.click(),document.body.removeChild(o),p(`TXT Scope exported (${v.toUpperCase()}).`)},V=t=>{var l;const s=(l=t.target.files)==null?void 0:l[0];if(!s)return;const a=new FileReader;a.onload=o=>{var n;try{const u=(n=o.target)==null?void 0:n.result,r=JSON.parse(u);if(!Array.isArray(r))throw new Error("Invalid format");r.forEach(x=>{x.name&&N(x.name)}),p(`Imported ${r.length} processes structure.`)}catch{p("Import failed.")}},a.readAsText(s),t.target.value=""},q=()=>{g(!0),setTimeout(()=>{const t=document.getElementById("sidebar-standard-select");if(t){t.focus();try{"showPicker"in t?t.showPicker():t.click()}catch{}}},300)};return i?e.jsxs("div",{className:"h-full flex flex-col animate-fade-in-up gap-4 relative",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-2xl border border-gray-100 dark:border-slate-800 shadow-sm flex flex-col md:flex-row gap-4 items-center justify-between shrink-0 transition-colors duration-500 ease-fluid",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative w-16 h-16 flex items-center justify-center shrink-0",children:[e.jsxs("svg",{className:"transform -rotate-90 w-16 h-16",children:[e.jsx("circle",{cx:"32",cy:"32",r:D,stroke:"currentColor",strokeWidth:"6",fill:"transparent",className:"text-gray-100 dark:text-slate-800"}),e.jsx("circle",{cx:"32",cy:"32",r:D,stroke:"currentColor",strokeWidth:"6",fill:"transparent",strokeDasharray:T,strokeDashoffset:X,className:`${f.textClass.replace("text-","text-opacity-80 ")} transition-all duration-1000 ease-out`,strokeLinecap:"round"})]}),e.jsxs("span",{className:"absolute text-xs font-black text-slate-700 dark:text-white",children:[S.percent,"%"]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:i.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[e.jsx("span",{className:`font-bold ${f.textClass}`,children:S.covered})," of ",S.total," clauses mapped."]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64 group",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-indigo-500 transition-colors",children:e.jsx(h,{name:"Search",size:16})}),e.jsx("input",{ref:L,className:"w-full pl-10 pr-8 py-2.5 bg-white dark:bg-slate-950 border border-indigo-100 dark:border-slate-700 rounded-xl text-sm font-bold text-slate-800 dark:text-slate-200 placeholder-slate-400 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/10 transition-all shadow-sm",placeholder:"Filter clauses...",value:C,onChange:t=>w(t.target.value)}),C&&e.jsx("button",{onClick:()=>{var t;w(""),(t=L.current)==null||t.focus()},className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 text-slate-400 hover:text-red-500 transition-colors",children:e.jsx(h,{name:"X",size:14})})]}),e.jsx("input",{type:"file",ref:z,className:"hidden",accept:".json",onChange:V}),e.jsx("button",{onClick:()=>{var t;return(t=z.current)==null?void 0:t.click()},className:"p-2.5 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-xl text-slate-600 dark:text-slate-300 shadow-sm active:scale-95 transition-all hover:border-indigo-300 dark:hover:border-slate-600",title:"Import Plan",children:e.jsx(h,{name:"UploadCloud",size:18})}),e.jsxs("button",{onClick:J,className:"p-2.5 px-4 bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-xl text-slate-600 dark:text-slate-300 shadow-sm active:scale-95 transition-all hover:border-indigo-300 dark:hover:border-slate-600 flex items-center gap-2",title:"Export Template (JSON)",children:[e.jsx(h,{name:"Grid",size:18}),e.jsx("span",{className:"text-xs font-bold hidden md:inline",children:"Template"})]})]})]}),e.jsx("div",{className:`flex-1 bg-white dark:bg-slate-900 rounded-2xl border ${f.borderClass.replace("border-","border-opacity-30 border-")} border-t-4 border-t-${f.borderClass.replace("border-","")} dark:border-slate-800 overflow-hidden shadow-sm relative flex flex-col transition-colors duration-500 ease-fluid`,children:d.length===0?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-400",children:[e.jsx("p",{className:"mb-4",children:"No processes defined."}),e.jsx("div",{className:"p-4 border-2 border-dashed border-indigo-200 dark:border-indigo-900/50 rounded-xl bg-indigo-50 dark:bg-indigo-900/10 text-indigo-500",children:"Create processes in the sidebar to begin planning."})]}):e.jsx("div",{className:"flex-1 overflow-auto custom-scrollbar relative",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:`${f.bgSoft.replace("50","50/80")} dark:bg-slate-950 sticky top-0 z-30 shadow-sm backdrop-blur-sm transition-colors duration-500 ease-fluid`,children:e.jsxs("tr",{children:[e.jsx("th",{className:`p-3 border-b border-r border-gray-200 dark:border-slate-800 sticky left-0 z-40 min-w-[300px] cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors group select-none ${f.bgSoft}`,onClick:B,title:O?"Click to Expand All":"Click to Collapse All",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider transition-colors ${f.textClass}`,children:"Clause Reference"})})}),d.map(t=>e.jsx("th",{className:`p-3 text-[10px] font-bold uppercase tracking-wider border-b border-gray-200 dark:border-slate-800 min-w-[120px] text-center ${f.textClass}`,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"truncate max-w-[100px]",title:t.name,children:t.name}),e.jsx("span",{className:"text-[10px] font-bold bg-white dark:bg-slate-800 px-2 py-0.5 rounded-full shadow-sm",children:Object.keys(t.matrixData).length})]})},t.id))]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-slate-800/50",children:H.map(t=>{const s=$.has(t.id),a=G(t.id),l=I(t.clauses);return e.jsxs(W.Fragment,{children:[e.jsxs("tr",{className:`sticky z-20 hover:brightness-95 transition-all duration-500 ease-fluid ${a}`,children:[e.jsx("td",{className:"p-2 border-r border-black/5 dark:border-white/5 font-black text-xs uppercase tracking-widest sticky left-0 z-20 bg-inherit shadow-sm cursor-pointer",onClick:()=>_(t.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{name:t.icon,size:14,className:"opacity-70"}),t.title]}),e.jsx(h,{name:"ChevronDown",size:14,className:`transition-transform duration-300 ${s?"-rotate-90":"rotate-0"}`})]})}),d.map(o=>{const n=[],u=y=>y.forEach(P=>{n.push(P.id),P.subClauses&&u(P.subClauses)});u(t.clauses);const r=d.find(y=>y.id===o.id),x=r?n.every(y=>!!r.matrixData[y]):!1;return e.jsx("td",{className:"p-2 text-center bg-inherit",children:!s&&e.jsx("button",{onClick:y=>M(y,o.id,t.clauses),className:"p-1.5 rounded-lg hover:bg-black/10 dark:hover:bg-white/10 transition-colors opacity-70 hover:opacity-100",title:x?"Deselect Group":"Select Entire Group",children:e.jsx(h,{name:x?"CheckSquare":"Square",size:16})})},`group_action_${o.id}_${t.id}`)})]}),!s&&l.map(({clause:o,level:n})=>e.jsx(ee,{clause:o,level:n,processes:d,onSmartToggle:F},o.id))]},t.id)})})]})})}),e.jsxs("div",{className:"flex-shrink-0 flex flex-row items-center md:justify-end gap-2 md:gap-3 w-full pt-2",children:[e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:K,disabled:d.length===0,className:"flex-none md:w-auto px-3 md:px-4 h-[52px] bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 hover:border-indigo-500 text-slate-700 dark:text-slate-200 rounded-xl text-xs font-bold flex items-center justify-center gap-2 transition-all duration-300 active:scale-95 shadow-sm disabled:opacity-50 whitespace-nowrap dark:shadow-md",children:[e.jsx(h,{name:"FileText"}),e.jsx("span",{className:"hidden md:inline",children:"Export"}),e.jsxs("div",{className:"lang-pill-container",children:[e.jsx("span",{onClick:t=>{t.stopPropagation(),R("en")},className:`lang-pill-btn ${v==="en"?"lang-pill-active":"lang-pill-inactive"}`,children:"EN"}),e.jsx("span",{onClick:t=>{t.stopPropagation(),R("vi")},className:`lang-pill-btn ${v==="vi"?"lang-pill-active":"lang-pill-inactive"}`,children:"VI"})]})]})]})]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400 bg-gray-50/30 dark:bg-slate-900/30 rounded-2xl border border-dashed border-gray-200 dark:border-slate-800 m-4 animate-fade-in-up",children:[e.jsx(h,{name:"Book",size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-slate-500",children:"No Standard Selected"}),e.jsxs("button",{onClick:q,className:"mt-6 px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow-lg text-xs font-bold flex items-center gap-2",children:[e.jsx(h,{name:"LayoutList",size:16})," Select Standard"]})]})};export{le as PlanningView};
