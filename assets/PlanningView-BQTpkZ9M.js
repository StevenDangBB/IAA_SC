import{r as m,j as e,R as et}from"./vendor-react--UE8qFvL.js";import{I as c,u as tt,b as at,a as st,T as rt,M as $e,e as lt,h as nt}from"./index-BGfGWBoP.js";import"./vendor-BhE6lIor.js";import"./vendor-genai-C0GBL7S7.js";const ot=({isOpen:d,onClose:j,selectedDates:x,onChange:p})=>{const[z,A]=m.useState(new Date),[R,w]=m.useState(!1),[q,_]=m.useState("add");if(m.useEffect(()=>{if(d&&x.length>0){const n=new Date(x[0]);isNaN(n.getTime())||A(n)}else A(new Date)},[d]),!d)return null;const T=z.getFullYear(),M=z.getMonth(),oe=(n,h)=>new Date(n,h+1,0).getDate(),J=(n,h)=>new Date(n,h,1).getDay(),se=oe(T,M),f=J(T,M),V=[];for(let n=0;n<f;n++)V.push(null);for(let n=1;n<=se;n++)V.push(new Date(T,M,n));const L=n=>{const h=n.getFullYear(),y=String(n.getMonth()+1).padStart(2,"0"),C=String(n.getDate()).padStart(2,"0");return`${h}-${y}-${C}`},re=(n,h)=>{const y=x.includes(n);let C=[...x];h==="toggle"?y?C=C.filter(W=>W!==n):C.push(n):h==="add"?y||C.push(n):h==="remove"&&y&&(C=C.filter(W=>W!==n)),C.sort(),p(C)},G=n=>{w(!0);const y=x.includes(n)?"remove":"add";_(y),re(n,y)},ee=n=>{R&&re(n,q)},E=()=>{w(!1)},X=n=>{A(new Date(T,M+n,1))},N=L(new Date);return e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-300",onMouseUp:E,children:e.jsxs("div",{className:"relative w-full max-w-lg bg-slate-900/80 backdrop-blur-xl border border-white/10 rounded-3xl shadow-2xl overflow-hidden animate-zoom-in-spring",onClick:n=>n.stopPropagation(),children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-orange-500/20 rounded-full blur-[80px] -translate-y-1/2 translate-x-1/2 pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 h-64 bg-indigo-500/20 rounded-full blur-[80px] translate-y-1/2 -translate-x-1/2 pointer-events-none"}),e.jsxs("div",{className:"relative p-6 border-b border-white/10 flex justify-between items-center z-10",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-black text-white tracking-tight flex items-center gap-2",children:[e.jsx(c,{name:"Session7_Compass",className:"text-orange-500"}),"Smart Scheduler"]}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Drag to select multiple days"})]}),e.jsx("button",{onClick:j,className:"p-2 rounded-full bg-white/5 hover:bg-white/10 text-slate-300 transition-colors",children:e.jsx(c,{name:"X",size:20})})]}),e.jsxs("div",{className:"p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:()=>X(-1),className:"p-2 rounded-xl hover:bg-white/10 text-white transition-colors",children:e.jsx(c,{name:"ChevronLeft"})}),e.jsx("span",{className:"text-lg font-bold text-white select-none",children:z.toLocaleString("default",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:()=>X(1),className:"p-2 rounded-xl hover:bg-white/10 text-white transition-colors",children:e.jsx(c,{name:"ChevronRight"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(n=>e.jsx("div",{className:"text-center text-xs font-bold text-slate-500 uppercase tracking-wider select-none",children:n},n))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",onMouseLeave:E,children:V.map((n,h)=>{if(!n)return e.jsx("div",{className:"h-10 md:h-12"},h);const y=L(n),C=x.includes(y),W=N===y;return e.jsxs("button",{onMouseDown:()=>G(y),onMouseEnter:()=>ee(y),className:`
                                        h-10 md:h-12 rounded-xl text-sm font-bold transition-all duration-200 select-none relative group
                                        ${C?"bg-gradient-to-br from-orange-500 to-amber-500 text-white shadow-[0_0_15px_rgba(249,115,22,0.4)] scale-105 z-10":"bg-white/5 text-slate-300 hover:bg-white/10"}
                                        ${W&&!C?"border border-orange-500/50 text-orange-400":"border border-transparent"}
                                    `,children:[n.getDate(),C&&e.jsx("div",{className:"absolute inset-0 rounded-xl ring-2 ring-white/20 animate-pulse"})]},y)})})]}),e.jsxs("div",{className:"p-4 bg-black/20 border-t border-white/5 flex justify-between items-center relative z-10",children:[e.jsxs("span",{className:"text-xs text-slate-400 font-medium",children:[x.length," days selected"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>p([]),className:"px-4 py-2 rounded-xl text-xs font-bold text-slate-400 hover:text-white hover:bg-white/5 transition-colors",children:"Clear"}),e.jsx("button",{onClick:j,className:"px-6 py-2 rounded-xl bg-white text-black font-bold text-xs hover:scale-105 transition-transform shadow-lg",children:"Done"})]})]})]})})},dt=({auditPlanConfig:d,setAuditPlanConfig:j,auditSites:x,setAuditSites:p,auditTeam:z,setAuditTeam:A,processes:R,updateProcessCode:w,updateProcessSites:q,handleGenerateSchedule:_,isGenerating:T,genProgress:M,genLogs:oe,logsEndRef:J,handleRemoveDate:se,safeAuditDates:f,isCalendarOpen:V,setIsCalendarOpen:L,handleUpdateDates:re})=>{var ne;const[G,ee]=m.useState("logistics"),[E,X]=m.useState(null),[N,n]=m.useState(null),[h,y]=m.useState({id:"",name:"",address:"",scope:"",isMain:!1,employeeCount:0}),[C,W]=m.useState(null),[S,te]=m.useState({name:"",role:"Auditor",competencyCodes:"",manDays:1,isRemote:!1,availability:"",availabilityMatrix:{}}),ue=a=>{ee(v=>v===a?"none":a)},U=()=>{if(!h.name.trim())return;const a={id:`site_${Date.now()}`,name:h.name.trim(),address:h.address||"",scope:h.scope||"",isMain:h.isMain,employeeCount:h.employeeCount||0};p(v=>[...v,a]),y({id:"",name:"",address:"",scope:"",isMain:!1,employeeCount:0})},be=a=>{X(a.id),n({...a})},le=()=>{N&&E&&(p(a=>a.map(v=>v.id===E?N:v)),X(null),n(null))},me=()=>{X(null),n(null)},ce=()=>{var a,v;if((a=S.name)!=null&&a.trim()){if(C)A(g=>g.map($=>$.id===C?{...$,...S}:$)),W(null);else{const g={id:`mem_${Date.now()}`,name:S.name.trim(),role:S.role,competencyCodes:((v=S.competencyCodes)==null?void 0:v.trim())||"",manDays:S.manDays||1,isRemote:S.isRemote||!1,availability:S.availability||"",availabilityMatrix:S.availabilityMatrix||{}};A($=>[...$,g])}te({name:"",role:"Auditor",competencyCodes:"",manDays:1,isRemote:!1,availability:"",availabilityMatrix:{}})}},pe=a=>{W(a.id),te({...a}),ee("team")},xe=(a,v,g)=>{te($=>{const Q=$.availabilityMatrix||{};let Y={...Q[a]||{mode:"onsite",allocation:1,slot:"FULL"}};v==="mode"?Y.mode=g:v==="slot"&&(Y.slot=g,g==="OFF"?Y.allocation=0:g==="FULL"?Y.allocation=1:Y.allocation=.5);const he={...Q,[a]:Y},ke=Object.values(he).reduce((O,B)=>O+(Number(B==null?void 0:B.allocation)||0),0);return{...$,availabilityMatrix:he,manDays:ke}})};return e.jsxs("div",{className:"w-[380px] min-w-[320px] border-r border-gray-100 dark:border-slate-800 bg-orange-50/50 dark:bg-orange-950/20 flex flex-col p-4 overflow-y-auto custom-scrollbar gap-3 h-full",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-gray-200 dark:border-slate-800 overflow-hidden shadow-sm shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors",onClick:()=>ue("logistics"),children:[e.jsxs("h4",{className:"text-xs font-black text-slate-500 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(c,{name:"Session7_Compass",size:14})," Logistics"]}),e.jsx(c,{name:"ChevronDown",size:12,className:`text-slate-400 transition-transform ${G==="logistics"?"rotate-180":""}`})]}),G!=="logistics"&&e.jsxs("div",{className:"px-3 pb-3 pt-0 text-[10px] text-slate-500",children:[f.length," Days • ",d.startTime," - ",d.endTime]}),G==="logistics"&&e.jsxs("div",{className:"p-3 pt-0 space-y-3 animate-accordion-down mt-2 h-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2 block",children:"Audit Dates"}),e.jsxs("button",{onClick:()=>L(!0),className:"w-full py-2 bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 text-white rounded-xl shadow-sm transition-all active:scale-95 flex items-center justify-center gap-2 mb-2 group",children:[e.jsx(c,{name:"Calendar",size:16,className:"group-hover:-rotate-12 transition-transform duration-500"}),e.jsxs("span",{className:"font-bold text-xs",children:["Manage Dates (",f.length,")"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:f.map((a,v)=>e.jsxs("span",{className:"flex items-center gap-1 bg-slate-50 dark:bg-slate-800 px-2 py-1 rounded border border-gray-200 dark:border-slate-700 text-[9px] font-mono text-slate-700 dark:text-slate-300",children:[a,e.jsx("button",{onClick:g=>{g.stopPropagation(),se(a)},className:"text-slate-400 hover:text-red-500 ml-1 rounded-full hover:bg-slate-200 dark:hover:bg-slate-600",children:e.jsx(c,{name:"X",size:10})})]},v))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[9px] font-bold text-slate-400 uppercase",children:"Start"}),e.jsx("input",{type:"time",className:"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded-lg p-1.5 text-xs outline-none focus:border-orange-500 text-slate-900 dark:text-white font-bold dark:[color-scheme:dark]",value:d.startTime,onChange:a=>j({...d,startTime:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[9px] font-bold text-slate-400 uppercase",children:"End"}),e.jsx("input",{type:"time",className:"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded-lg p-1.5 text-xs outline-none focus:border-orange-500 text-slate-900 dark:text-white font-bold dark:[color-scheme:dark]",value:d.endTime,onChange:a=>j({...d,endTime:a.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[9px] font-bold text-slate-400 uppercase",children:"Lunch Start"}),e.jsx("input",{type:"time",className:"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded-lg p-1.5 text-xs outline-none focus:border-orange-500 text-slate-900 dark:text-white font-bold dark:[color-scheme:dark]",value:d.lunchStartTime,onChange:a=>j({...d,lunchStartTime:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[9px] font-bold text-slate-400 uppercase",children:"Lunch End"}),e.jsx("input",{type:"time",className:"w-full bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded-lg p-1.5 text-xs outline-none focus:border-orange-500 text-slate-900 dark:text-white font-bold dark:[color-scheme:dark]",value:d.lunchEndTime,onChange:a=>j({...d,lunchEndTime:a.target.value})})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-gray-200 dark:border-slate-800 overflow-hidden shadow-sm shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors",onClick:()=>ue("sites"),children:[e.jsxs("h4",{className:"text-xs font-black text-slate-500 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(c,{name:"MapPin",size:14})," Sites (",x.length,")"]}),e.jsx(c,{name:"ChevronDown",size:12,className:`text-slate-400 transition-transform ${G==="sites"?"rotate-180":""}`})]}),G!=="sites"&&e.jsx("div",{className:"px-3 pb-3 pt-0 text-[10px] text-slate-500 truncate",children:x.map(a=>a.name).join(", ")||"No sites added"}),G==="sites"&&e.jsxs("div",{className:"p-3 pt-0 space-y-3 animate-accordion-down mt-2 h-auto",children:[e.jsx("div",{className:"space-y-1 max-h-[150px] overflow-y-auto custom-scrollbar p-1",children:x.map(a=>{const v=E===a.id;return e.jsxs("div",{className:`flex justify-between items-center p-2 rounded-lg group border cursor-pointer transition-all ${v?"bg-slate-50 dark:bg-slate-800 border-orange-500 ring-1 ring-orange-500/20":"bg-slate-50 dark:bg-slate-800 border-transparent hover:border-orange-200 dark:hover:border-orange-800"}`,onClick:()=>be(a),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-bold text-slate-800 dark:text-slate-200",children:[a.name," ",a.isMain&&e.jsx("span",{className:"text-[9px] bg-orange-100 text-orange-600 px-1 rounded",children:"HQ"})]}),e.jsxs("div",{className:"text-[9px] text-slate-500 flex gap-1",children:[e.jsxs("span",{children:[a.employeeCount||0," Staff"]}),a.address&&e.jsxs("span",{className:"truncate max-w-[120px] opacity-70",children:["• ",a.address]})]})]}),e.jsx("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100",children:e.jsx("button",{onClick:g=>{g.stopPropagation(),p($=>$.filter(Q=>Q.id!==a.id))},className:"text-slate-400 hover:text-red-500",children:e.jsx(c,{name:"X",size:12})})})]},a.id)})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-slate-800/50 p-2 rounded-lg border border-gray-100 dark:border-slate-800 space-y-2",children:[e.jsx("input",{className:"w-full bg-white dark:bg-slate-950 border border-gray-200 dark:border-slate-700 rounded-md p-1.5 text-xs font-medium text-slate-900 dark:text-white outline-none focus:border-orange-500",placeholder:"Site Name",value:E?N==null?void 0:N.name:h.name,onChange:a=>E?n({...N,name:a.target.value}):y({...h,name:a.target.value})}),e.jsx("input",{className:"w-full bg-white dark:bg-slate-950 border border-gray-200 dark:border-slate-700 rounded-md p-1.5 text-xs font-medium text-slate-900 dark:text-white outline-none focus:border-orange-500",placeholder:"Address",value:E?N==null?void 0:N.address:h.address,onChange:a=>E?n({...N,address:a.target.value}):y({...h,address:a.target.value})}),e.jsx("input",{className:"w-full bg-white dark:bg-slate-950 border border-gray-200 dark:border-slate-700 rounded-md p-1.5 text-xs font-medium text-slate-900 dark:text-white outline-none focus:border-orange-500",placeholder:"Scope (Optional)",value:E?N==null?void 0:N.scope:h.scope,onChange:a=>E?n({...N,scope:a.target.value}):y({...h,scope:a.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 bg-white dark:bg-slate-950 border border-gray-200 dark:border-slate-700 rounded-md p-1.5 text-xs font-medium text-slate-900 dark:text-white outline-none focus:border-orange-500 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",type:"number",placeholder:"Staff Count",value:E?N==null?void 0:N.employeeCount:h.employeeCount||"",onChange:a=>E?n({...N,employeeCount:parseInt(a.target.value)}):y({...h,employeeCount:parseInt(a.target.value)})}),e.jsxs("label",{className:"flex-1 flex items-center justify-center gap-2 cursor-pointer bg-white dark:bg-slate-950 border border-gray-200 dark:border-slate-700 rounded-md p-1.5 hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:E?N==null?void 0:N.isMain:h.isMain,onChange:a=>E?n({...N,isMain:a.target.checked}):y({...h,isMain:a.target.checked}),className:"accent-orange-500"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-700 dark:text-slate-300",children:"HQ Site"})]})]}),E?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:le,className:"flex-1 bg-emerald-500 text-white rounded py-1 text-xs font-bold",children:"Save"}),e.jsx("button",{onClick:me,className:"flex-1 bg-slate-200 text-slate-600 rounded py-1 text-xs font-bold",children:"Cancel"})]}):e.jsxs("button",{onClick:U,className:"w-full bg-indigo-50 text-indigo-600 border border-indigo-100 hover:bg-indigo-100 rounded py-1 text-xs font-bold flex items-center justify-center gap-1",children:[e.jsx(c,{name:"Plus",size:12})," Add Site"]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-gray-200 dark:border-slate-800 overflow-hidden shadow-sm shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors",onClick:()=>ue("team"),children:[e.jsxs("h4",{className:"text-xs font-black text-slate-500 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(c,{name:"Users",size:14})," Audit Team (",z.length,")"]}),e.jsx(c,{name:"ChevronDown",size:12,className:`text-slate-400 transition-transform ${G==="team"?"rotate-180":""}`})]}),G!=="team"&&e.jsx("div",{className:"px-3 pb-3 pt-0 text-[10px] text-slate-500 truncate",children:z.map(a=>a.name).join(", ")||"No members added"}),G==="team"&&e.jsxs("div",{className:"p-3 pt-0 space-y-2 animate-accordion-down mt-2 h-auto",children:[e.jsx("div",{className:"space-y-2 max-h-[150px] overflow-y-auto custom-scrollbar mb-3 p-1",children:z.map(a=>{var g;const v=C===a.id;return e.jsxs("div",{className:`flex justify-between items-start p-3 bg-slate-50 dark:bg-slate-800 rounded-lg group border cursor-pointer transition-all ${v?"border-orange-500 ring-1 ring-orange-500/20 z-10":"border-transparent hover:border-orange-200 dark:hover:border-orange-800"}`,onClick:()=>pe(a),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-bold text-slate-800 dark:text-slate-200 flex items-center gap-2",children:[a.name,a.role==="Lead Auditor"&&e.jsx(c,{name:"Award",size:12,className:"text-amber-500"}),a.isRemote&&e.jsx("span",{className:"bg-purple-100 text-purple-600 px-1 py-0.5 rounded text-[8px] uppercase tracking-wider font-black",children:"Remote"})]}),e.jsxs("div",{className:"text-[9px] text-slate-500 flex gap-1 mt-0.5",children:[e.jsx("span",{children:a.role}),e.jsxs("span",{className:"font-mono text-slate-400",children:["• ",((g=a.manDays)==null?void 0:g.toFixed(1))||0," WD"]}),a.competencyCodes&&e.jsxs("span",{className:"font-mono text-teal-600 bg-teal-50 px-1 rounded",children:["[",a.competencyCodes,"]"]})]}),a.availability&&e.jsx("div",{className:"text-[9px] text-slate-400 italic mt-1 leading-snug border-l-2 border-slate-200 dark:border-slate-700 pl-1.5",children:a.availability})]}),e.jsx("button",{onClick:$=>{$.stopPropagation(),A(Q=>Q.filter(ge=>ge.id!==a.id))},className:"text-slate-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(c,{name:"X",size:12})})]},a.id)})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-slate-800/50 p-2 rounded-lg border border-gray-100 dark:border-slate-800 space-y-2 mt-4",children:[e.jsx("input",{className:"w-full bg-white dark:bg-slate-950 border border-gray-200 dark:border-slate-700 rounded-md p-1.5 text-xs font-medium text-slate-900 dark:text-white outline-none focus:border-orange-500",placeholder:"Name",value:S.name,onChange:a=>te({...S,name:a.target.value})}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("select",{className:"flex-[2] bg-white dark:bg-slate-950 border border-gray-200 dark:border-slate-700 rounded-md p-1.5 text-xs font-medium outline-none text-slate-900 dark:text-white",value:S.role,onChange:a=>te({...S,role:a.target.value}),children:[e.jsx("option",{className:"bg-white dark:bg-slate-950",value:"Auditor",children:"Auditor"}),e.jsx("option",{className:"bg-white dark:bg-slate-950",value:"Lead Auditor",children:"Lead Auditor"}),e.jsx("option",{className:"bg-white dark:bg-slate-950",value:"Technical Expert",children:"Technical Expert"}),e.jsx("option",{className:"bg-white dark:bg-slate-950",value:"Observer",children:"Observer"})]}),e.jsx("input",{className:"flex-1 bg-white dark:bg-slate-950 border border-gray-200 dark:border-slate-700 rounded-md p-1.5 text-xs font-medium text-slate-900 dark:text-white outline-none focus:border-orange-500 text-center min-w-0",placeholder:"Code",value:S.competencyCodes,onChange:a=>te({...S,competencyCodes:a.target.value})}),e.jsx("input",{className:"flex-1 bg-gray-100 dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-md p-1.5 text-xs font-bold text-slate-500 dark:text-slate-400 outline-none text-center cursor-not-allowed [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none min-w-0",type:"number",placeholder:"WD",value:(ne=S.manDays)==null?void 0:ne.toFixed(1),readOnly:!0,title:"Auto-calculated from allocation below"})]}),f.length>0&&e.jsxs("div",{className:"bg-white dark:bg-slate-950 p-2 rounded-lg border border-gray-200 dark:border-slate-700",children:[e.jsx("label",{className:"text-[9px] font-bold text-slate-500 uppercase block mb-1",children:"Session & Mode Per Day"}),e.jsx("div",{className:"space-y-1",children:f.map(a=>{var Q;const v=((Q=S.availabilityMatrix)==null?void 0:Q[a])||{mode:S.isRemote?"remote":"onsite",slot:"FULL"},g=v.mode==="remote",$=v.slot==="OFF";return e.jsxs("div",{className:`flex items-center gap-2 text-[10px] transition-opacity ${$?"opacity-50":"opacity-100"}`,children:[e.jsx("span",{className:"w-16 font-mono text-slate-600 dark:text-slate-400",children:a}),e.jsxs("div",{className:`flex-1 flex rounded border cursor-pointer select-none overflow-hidden ${g?"border-purple-200 bg-purple-50":"border-slate-200 bg-slate-50"}`,onClick:()=>!$&&xe(a,"mode",g?"onsite":"remote"),title:$?"Mode irrelevant when Not Participating":"Toggle Remote/Onsite",children:[e.jsx("div",{className:`flex-1 text-center py-0.5 ${!g&&!$?"bg-indigo-500 text-white font-bold":"text-slate-400"}`,children:"Onsite"}),e.jsx("div",{className:`flex-1 text-center py-0.5 ${g&&!$?"bg-purple-500 text-white font-bold":"text-slate-400"}`,children:"Remote"})]}),e.jsxs("select",{className:"w-20 border border-gray-200 dark:border-slate-700 bg-transparent rounded p-0.5 text-slate-800 dark:text-white outline-none cursor-pointer text-xs",value:v.slot||"FULL",onChange:ge=>xe(a,"slot",ge.target.value),title:"Session Allocation",children:[e.jsx("option",{className:"bg-white dark:bg-slate-950",value:"FULL",children:"Full Day (1.0)"}),e.jsx("option",{className:"bg-white dark:bg-slate-950",value:"AM",children:"Morning (0.5)"}),e.jsx("option",{className:"bg-white dark:bg-slate-950",value:"PM",children:"Afternoon (0.5)"}),e.jsx("option",{className:"bg-white dark:bg-slate-950",value:"OFF",children:"Off / Not Participating (0.0)"})]})]},a)})})]}),e.jsx("input",{className:"w-full bg-white dark:bg-slate-950 border border-gray-200 dark:border-slate-700 rounded-md p-1.5 text-xs font-medium text-slate-900 dark:text-white outline-none focus:border-orange-500",placeholder:"Availability / Notes",value:S.availability,onChange:a=>te({...S,availability:a.target.value})}),e.jsx("button",{onClick:ce,className:"w-full bg-indigo-50 text-indigo-600 border border-indigo-100 hover:bg-indigo-100 rounded py-1 text-xs font-bold flex items-center justify-center gap-1",children:C?"Update Member":e.jsxs(e.Fragment,{children:[e.jsx(c,{name:"Plus",size:12})," Add Member"]})}),C&&e.jsx("button",{onClick:()=>{W(null),te({name:"",role:"Auditor",competencyCodes:"",manDays:1,isRemote:!1,availability:"",availabilityMatrix:{}})},className:"w-full text-[9px] text-slate-400 underline",children:"Cancel Edit"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-gray-200 dark:border-slate-800 shadow-sm flex flex-col shrink-0",children:[e.jsx("div",{className:"flex justify-between items-center p-3 border-b border-gray-100 dark:border-slate-800 bg-gray-50/50 dark:bg-slate-800/30",children:e.jsxs("h4",{className:"text-xs font-black text-slate-500 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(c,{name:"Tag",size:14})," Process Mapping"]})}),e.jsxs("div",{className:"p-3 pt-2 space-y-2",children:[R.map(a=>{var v;return e.jsxs("div",{className:"p-2 bg-slate-50 dark:bg-slate-800 rounded-lg border border-gray-100 dark:border-slate-700 text-xs",children:[e.jsxs("div",{className:"font-bold text-slate-800 dark:text-slate-200 mb-1 flex items-center gap-2",children:[e.jsx("span",{className:"truncate flex-1",children:a.name}),e.jsxs("span",{className:"text-[9px] font-mono bg-slate-200 dark:bg-slate-700 px-1 rounded",children:[Object.keys(a.matrixData).length," Clauses"]})]}),e.jsxs("div",{className:"grid grid-cols-[60px_1fr] gap-2",children:[e.jsx("input",{className:"w-full bg-white dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded p-1 text-[9px] font-mono font-bold text-center outline-none text-slate-900 dark:text-orange-400 focus:ring-1 focus:ring-orange-500 placeholder-slate-300 dark:placeholder-slate-600",placeholder:"CODE",value:a.competencyCode||"",onChange:g=>w(a.id,g.target.value)}),e.jsxs("select",{className:"w-full bg-white dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded p-1 text-[9px] font-medium text-slate-700 dark:text-slate-200 outline-none focus:ring-1 focus:ring-orange-500",value:((v=a.siteIds)==null?void 0:v[0])||"",onChange:g=>q(a.id,g.target.value?[g.target.value]:[]),children:[e.jsx("option",{value:"",children:"All Sites"}),x.map(g=>e.jsx("option",{value:g.id,children:g.name},g.id))]})]})]},a.id)}),R.length===0&&e.jsx("div",{className:"text-center py-4 text-slate-400 text-xs italic",children:"No processes defined."})]})]}),e.jsxs("button",{onClick:_,disabled:T,className:`w-full py-3 rounded-xl font-bold text-xs shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2 mt-auto flex-shrink-0 ${T?"bg-gray-200 dark:bg-slate-800 text-slate-400 cursor-not-allowed":"btn-shrimp text-white hover:shadow-indigo-500/40"}`,children:[T?e.jsx(c,{name:"Loader",className:"animate-spin",size:14}):e.jsx(c,{name:"Wand2",size:14}),T?"AI Planning...":"GENERATE SCHEDULE"]}),e.jsx(ot,{isOpen:V,onClose:()=>L(!1),selectedDates:f,onChange:re})]})},K=d=>{if(!d)return 0;const[j,x]=d.split(":").map(Number);return(Number(j)||0)*60+(Number(x)||0)},we=d=>{const j=Math.floor(d/60),x=d%60;return`${j.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`},it=({isOpen:d,onClose:j,targetItem:x,availableDates:p,onSave:z})=>{const[A,R]=m.useState(""),[w,q]=m.useState(""),[_,T]=m.useState(""),[M,oe]=m.useState(!0);m.useEffect(()=>{var f,V;if(d&&x){R(x.date||p[0]);const L=x.timeSlot?x.timeSlot.split("-"):[];q(((f=L[0])==null?void 0:f.trim())||"08:30"),T(((V=L[1])==null?void 0:V.trim())||"09:30")}},[d,x,p]);const J=f=>{const V=Number(K(w)),re=Number(K(_))-V;if(q(f),re>0){const G=Number(K(f));T(we(G+re))}},se=()=>{w&&_&&A&&(z(A,w,_,M),j())};return d?e.jsx($e,{isOpen:d,title:"Reschedule Activity",onClose:j,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 p-3 rounded-xl border border-orange-100 dark:border-orange-800",children:[e.jsx("span",{className:"text-[10px] font-bold text-orange-600 dark:text-orange-400 uppercase tracking-wider block mb-1",children:"Target Activity"}),e.jsx("p",{className:"text-xs font-bold text-slate-700 dark:text-slate-200 whitespace-pre-wrap",children:x==null?void 0:x.activity}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("span",{className:"text-[9px] bg-white dark:bg-slate-800 px-2 py-0.5 rounded border border-orange-200 dark:border-orange-700/50 text-slate-500",children:x==null?void 0:x.siteName}),e.jsx("span",{className:"text-[9px] bg-white dark:bg-slate-800 px-2 py-0.5 rounded border border-orange-200 dark:border-orange-700/50 text-slate-500",children:x==null?void 0:x.processName})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Audit Date"}),e.jsx("select",{value:A,onChange:f=>R(f.target.value),className:"w-full p-2 bg-white dark:bg-slate-950 border border-gray-200 dark:border-slate-700 rounded-xl text-sm font-bold text-slate-900 dark:text-white outline-none focus:border-indigo-500",children:p.map(f=>e.jsx("option",{value:f,className:"text-slate-900 dark:text-white bg-white dark:bg-slate-950",children:f},f))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Start Time"}),e.jsx("input",{type:"time",value:w,onChange:f=>J(f.target.value),className:"w-full p-2 bg-white dark:bg-slate-950 border border-gray-200 dark:border-slate-700 rounded-xl text-sm font-bold text-slate-900 dark:text-white outline-none focus:border-indigo-500 dark:[color-scheme:dark]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"End Time"}),e.jsx("input",{type:"time",value:_,onChange:f=>T(f.target.value),className:"w-full p-2 bg-white dark:bg-slate-950 border border-gray-200 dark:border-slate-700 rounded-xl text-sm font-bold text-slate-900 dark:text-white outline-none focus:border-indigo-500 dark:[color-scheme:dark]"})]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("label",{className:"flex items-center gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-xl cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:f=>oe(f.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-blue-700 dark:text-blue-300 block",children:"Auto-Cascade Schedule"}),e.jsx("span",{className:"text-[10px] text-blue-600/70 dark:text-blue-400/70",children:"Automatically shift overlapping tasks for this auditor down to avoid conflicts."})]})]})})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{onClick:se,className:"w-full py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold text-xs shadow-lg shadow-indigo-500/30 transition-all active:scale-95",children:"Confirm & Update Plan"})})]})}):null},Ce=d=>{let j=[d.id];return d.subClauses&&d.subClauses.forEach(x=>{j=[...j,...Ce(x)]}),j},ct=m.memo(({clause:d,level:j,processes:x,onSmartToggle:p})=>{const z=m.useMemo(()=>Ce(d),[d]),A=d.subClauses&&d.subClauses.length>0;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-800/30 transition-colors group duration-300 ease-fluid",children:[e.jsx("td",{className:"p-2 border-r border-gray-100 dark:border-slate-800 sticky left-0 bg-white dark:bg-slate-900 group-hover:bg-gray-50 dark:group-hover:bg-slate-800/30 z-10 align-top transition-colors duration-300 ease-fluid",children:e.jsx("div",{className:`flex flex-col gap-1 ${j>0?"ml-4 border-l-2 border-gray-200 dark:border-slate-800 pl-2":""}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[10px] font-bold whitespace-nowrap ${j===0?"bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700":"text-slate-400"}`,children:d.code}),e.jsx("span",{className:`text-xs truncate ${j===0?"font-bold text-slate-800 dark:text-slate-200":"font-medium text-slate-600 dark:text-slate-400"}`,children:d.title})]})})}),x.map(R=>{let w="none";if(A){const q=z.reduce((_,T)=>_+(R.matrixData[T]?1:0),0);q===z.length?w="all":q>0&&(w="some")}else w=R.matrixData[d.id]?"all":"none";return e.jsx("td",{className:"p-1 text-center border-r border-gray-50 dark:border-slate-800/50 last:border-0 relative align-middle",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:()=>p(R.id,d),className:`w-8 h-8 rounded-lg flex items-center justify-center transition-all duration-300 ease-spring ${w==="all"?"bg-emerald-500 text-white shadow-sm shadow-emerald-500/40 transform scale-105":w==="some"?"bg-orange-100 dark:bg-orange-900/30 text-orange-500 border border-orange-200 dark:border-orange-800":"bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-300"}`,title:w==="all"?"Fully Planned":w==="some"?"Partially Planned (Click to Fill)":"Click to Plan",children:[w==="all"&&(A?e.jsx(c,{name:"CheckCircle2",size:14}):e.jsx(c,{name:"CheckThick",size:14})),w==="some"&&e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-orange-500"})]})})},`${R.id}_${d.id}`)})]})},(d,j)=>d.processes.length!==j.processes.length?!1:!d.processes.some((p,z)=>{const A=j.processes[z];return p.matrixData!==A.matrixData})),gt=({onExport:d})=>{const{standards:j,standardKey:x,processes:p,auditInfo:z,batchUpdateProcessClauses:A,toggleProcessClause:R,auditSites:w,setAuditSites:q,auditTeam:_,setAuditTeam:T,auditPlanConfig:M,setAuditPlanConfig:oe,auditSchedule:J,setAuditSchedule:se,updateProcessCode:f,updateProcessSites:V}=tt(),{showToast:L,setSidebarOpen:re}=at(),{getActiveKey:G}=st(),[ee,E]=m.useState("matrix"),[X,N]=m.useState(""),n=m.useRef(null),h=m.useRef(null),[y,C]=m.useState(new Set),[W,S]=m.useState("en"),[te,ue]=m.useState(!1),[U,be]=m.useState(null),[le,me]=m.useState(null),[ce,pe]=m.useState(!1),[xe,ne]=m.useState(0),[a,v]=m.useState([]),[g,$]=m.useState(["siteName","timeSlot","auditorName","processName","activity","clauseRefs"]),[Q,ge]=m.useState(""),[Y,he]=m.useState(null),ke={timeSlot:"Time",siteName:"Site",auditorName:"Auditor",clauseRefs:"Clauses",activity:"Detailed Activity / Agenda",processName:"Process / Auditee"},O=j[x],B=rt.find(t=>t.id==="planning"),je=Array.isArray(M.auditDates)?M.auditDates:[];m.useEffect(()=>{ce&&h.current&&h.current.scrollIntoView({behavior:"smooth"})},[a,ce]);const ie=t=>v(s=>[...s,t]),ze=(t,s)=>{he(s),t.dataTransfer.effectAllowed="move",t.dataTransfer.setDragImage(t.currentTarget,20,20)},Re=(t,s)=>{if(t.preventDefault(),!Y||Y===s)return;const l=[...g],r=l.indexOf(Y),o=l.indexOf(s);l.splice(r,1),l.splice(o,0,Y),$(l)},Te=()=>he(null),Le=t=>[...t].sort((s,l)=>{for(const r of g){const o=s[r]??"",i=l[r]??"";if(o!==i)return String(o).localeCompare(String(i),void 0,{numeric:!0,sensitivity:"base"})}return 0}),Pe=(t,s)=>{const l={};for(let r=0;r<t.length;r++)for(let o=0;o<s.length;o++){const i=`${r}_${o}`;l[i]!==0&&(l[i]=1)}for(let r=0;r<s.length;r++){const o=s[r];for(let i=0;i<t.length;i++){const D=`${i}_${r}`;if(l[D]===0)continue;const u=t[i][o];for(let k=i+1;k<t.length;k++){const b=t[k][o],F=`${k}_${r}`;let I=!0;if(r>0){for(let H=0;H<r;H++)if(t[i][s[H]]!==t[k][s[H]]){I=!1;break}}if(u===b&&I){const H=l[D]||0;l[D]=H+1,l[F]=0}else break}}}return l},Se=(t,s,l)=>{se(r=>{const o=[...r];return o[t]={...o[t],[s]:l},o})},Oe=(t,s,l,r)=>{if(!le)return;le.item;const o=je.indexOf(t),i=o>=0?o+1:1;se(D=>{let u=[...D];const k=le.rowIndex,b={...u[k],date:t,day:i,timeSlot:`${s} - ${l}`};if(u[k]=b,r){const F=Number(K(s)),I=Number(K(l)),H=b.auditorName,de=u.map((P,ae)=>({...P,originalIndex:ae})).filter(P=>P.date===t&&P.auditorName===H&&P.originalIndex!==k).sort((P,ae)=>Number(K(P.timeSlot.split("-")[0]))-Number(K(ae.timeSlot.split("-")[0])));let Z=I;for(let P=0;P<de.length;P++){const ae=de[P],[Qe,Ye]=ae.timeSlot.split("-").map(ve=>ve.trim()),Ae=Number(K(Qe)),fe=Number(K(Ye)),Ze=fe-Ae;if(Ae<Z&&fe>F){const ve=Z,Ee=ve+Ze;u[ae.originalIndex]={...u[ae.originalIndex],timeSlot:`${we(ve)} - ${we(Ee)}`},Z=Ee}else fe>Z&&(Z=fe)}}return u}),me(null),L("Schedule updated & re-balanced.")},Fe=t=>{const s=J.filter(D=>D.day===t);if(s.length===0)return 0;const l=Number(K(M.lunchStartTime)),r=Number(K(M.lunchEndTime)),o=[...new Set(s.map(D=>D.auditorName))];let i=0;return o.forEach(D=>{const k=s.filter(b=>b.auditorName===D).reduce((b,F)=>{const I=F.timeSlot.split("-");if(I.length<2)return b;const H=Number(K(I[0].trim())),de=Number(K(I[1].trim()));let Z=de-H;const P=Math.max(H,l),ae=Math.min(de,r);return ae>P&&(Z-=ae-P),b+Math.max(0,Z)},0);k>i&&(i=k)}),i/60},Ie=t=>{const s=t.toUpperCase();return s.includes("PLAN")?"bg-orange-50 hover:bg-orange-100 dark:bg-orange-900/20 dark:hover:bg-orange-900/30 text-orange-700 dark:text-orange-400 border-l-4 border-orange-500":s.includes("SUPPORT")?"bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 text-blue-700 dark:text-blue-400 border-l-4 border-blue-500":s.includes("DO")?"bg-cyan-50 hover:bg-cyan-100 dark:bg-cyan-900/20 dark:hover:bg-cyan-900/30 text-cyan-700 dark:text-cyan-400 border-l-4 border-cyan-500":s.includes("CHECK")||s.includes("ACT")?"bg-emerald-50 hover:bg-emerald-100 dark:bg-emerald-900/20 dark:hover:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 border-l-4 border-emerald-500":s.includes("ANNEX")?"bg-purple-50 hover:bg-purple-100 dark:bg-purple-900/20 dark:hover:bg-purple-900/30 text-purple-700 dark:text-purple-400 border-l-4 border-purple-500":`${B.bgSoft} border-l-4 ${B.borderClass} ${B.textClass}`},_e=m.useMemo(()=>t=>{const s=[],l=(r,o)=>{r.forEach(i=>{s.push({clause:i,level:o}),i.subClauses&&l(i.subClauses,o+1)})};return l(t,0),s},[]),Ge=m.useCallback((t,s)=>{const l=p.find(i=>i.id===t);if(!l)return;const r=Ce(s);if(!(r.length>1))R(t,s.id);else if(r.reduce((u,k)=>u+(l.matrixData[k]?1:0),0)===r.length)r.forEach(u=>{l.matrixData[u]&&R(t,u)});else{const u=r.filter(k=>!l.matrixData[k]);u.length>0&&A([{processId:t,clauses:u}])}},[p,R,A]),Ue=(t,s,l)=>{t.stopPropagation();const r=[],o=u=>u.forEach(k=>{r.push(k.id),k.subClauses&&o(k.subClauses)});o(l);const i=p.find(u=>u.id===s);if(!i)return;if(r.every(u=>!!i.matrixData[u]))r.forEach(u=>{i.matrixData[u]&&R(s,u)});else{const u=r.filter(k=>!i.matrixData[k]);A([{processId:s,clauses:u}])}},We=t=>{C(s=>{const l=new Set(s);return l.has(t)?l.delete(t):l.add(t),l})},De=m.useMemo(()=>O?O.groups.every(t=>y.has(t.id)):!1,[O,y]),Be=()=>{if(!O)return;const t=O.groups.map(s=>s.id);C(De?new Set:new Set(t))},Me=m.useMemo(()=>{if(!O)return{percent:0,covered:0,total:0};let t=0;const s=r=>r.forEach(o=>{t++,o.subClauses&&s(o.subClauses)});if(O.groups.forEach(r=>s(r.clauses)),t===0)return{percent:0,covered:0,total:0};const l=new Set;return p.forEach(r=>{Object.keys(r.matrixData).forEach(o=>l.add(o))}),{percent:Math.round(l.size/t*100),covered:l.size,total:t}},[O,p]),Ne=24,ye=2*Math.PI*Ne,He=ye-Me.percent/100*ye,Ke=m.useMemo(()=>{if(!O)return[];if(!X)return O.groups;const t=X.toLowerCase();return O.groups.map(s=>{const l=s.clauses.filter(r=>{var D;const o=r.code.toLowerCase().includes(t)||r.title.toLowerCase().includes(t),i=(D=r.subClauses)==null?void 0:D.some(u=>u.code.toLowerCase().includes(t)||u.title.toLowerCase().includes(t));return o||i});return l.length>0?{...s,clauses:l}:null}).filter(s=>s!==null)},[O,X]),Ve=t=>{oe({...M,auditDates:t})},Xe=t=>{const l=(Array.isArray(M.auditDates)?M.auditDates:[]).filter(r=>r!==t);oe({...M,auditDates:l})},qe=async()=>{const t=G();if(!t){L("API Key Required.");return}if(_.length===0){L("Please add at least one auditor.");return}if(p.length===0){L("No processes found to schedule.");return}if((Array.isArray(M.auditDates)?M.auditDates:[]).length===0){L("Please add at least one audit date.");return}pe(!0),ne(5),v(["Initializing Smart Planner...","Validating resources and process map..."]);try{setTimeout(()=>{ne(20),ie("Analyzing Auditor Competencies...")},800),setTimeout(()=>{ne(40),ie(`Mapping ${p.length} Processes to Sites...`)},2e3),setTimeout(()=>{ne(60),ie("Optimizing time slots & balancing workload...")},3500),setTimeout(()=>{ne(80),ie("Finalizing Agenda Structure...")},5e3);const l=w.length>0?w:[{id:"default_main_site",name:z.company||"Main Organization Site",address:z.address||"",isMain:!0,scope:"Whole Organization",employeeCount:z.totalEmployees}];w.length===0&&ie("Note: No specific sites added. Using Organization Context as single audit location.");const r=await lt(l,_,p,M,t.key,t.activeModel),o=nt(r);if(Array.isArray(o)&&o.length>0)ne(100),ie("Success! Rendering Schedule..."),await new Promise(i=>setTimeout(i,800)),se(o),L("Schedule Generated Successfully!");else throw new Error("AI returned invalid schedule format. Try again.")}catch(l){console.error(l),ie(`ERROR: ${l.message}`),L("Planning Failed: Check Logs."),await new Promise(r=>setTimeout(r,2e3))}finally{pe(!1)}},Je=()=>{re(!0),setTimeout(()=>{const t=document.getElementById("sidebar-standard-select");if(t){t.focus();try{t.showPicker()}catch{t.click()}}},300)};return O?e.jsxs("div",{className:"h-full flex flex-col animate-fade-in-up gap-4 relative",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-2xl border border-gray-100 dark:border-slate-800 shadow-sm flex flex-col md:flex-row gap-4 items-center justify-between shrink-0 transition-colors duration-500 ease-fluid",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative w-16 h-16 flex items-center justify-center shrink-0",children:[e.jsxs("svg",{className:"transform -rotate-90 w-16 h-16",children:[e.jsx("circle",{cx:"32",cy:"32",r:Ne,stroke:"currentColor",strokeWidth:"6",fill:"transparent",className:"text-gray-200 dark:text-slate-700"}),e.jsx("circle",{cx:"32",cy:"32",r:Ne,stroke:"currentColor",strokeWidth:"6",fill:"transparent",strokeDasharray:ye,strokeDashoffset:He,className:"text-orange-500 dark:text-orange-400 transition-all duration-1000 ease-out filter drop-shadow-sm",strokeLinecap:"round"})]}),e.jsxs("span",{className:"absolute text-sm font-black text-orange-600 dark:text-orange-400",children:[Me.percent,"%"]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:O.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>E("matrix"),className:`text-xs px-3 py-1 rounded-full font-bold transition-all ${ee==="matrix"?"bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400":"text-slate-400 hover:bg-gray-100 dark:hover:bg-slate-800"}`,children:"1. Clause Matrix"}),e.jsx("button",{onClick:()=>E("resources"),className:`text-xs px-3 py-1 rounded-full font-bold transition-all ${ee==="resources"?"bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400":"text-slate-400 hover:bg-gray-100 dark:hover:bg-slate-800"}`,children:"2. Logistics & Schedule"})]})]})]}),ee==="matrix"&&e.jsx("div",{className:"flex items-center gap-2 w-full md:w-auto",children:e.jsxs("div",{className:"relative flex-1 md:w-64 group",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-indigo-500 transition-colors",children:e.jsx(c,{name:"Search",size:16})}),e.jsx("input",{ref:n,className:"w-full pl-10 pr-8 py-2.5 bg-white dark:bg-slate-950 border border-indigo-100 dark:border-slate-700 rounded-xl text-sm font-medium text-slate-800 dark:text-slate-200 placeholder-slate-400 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/10 transition-all shadow-sm",placeholder:"Filter clauses...",value:X,onChange:t=>N(t.target.value)}),X&&e.jsx("button",{onClick:()=>{var t;N(""),(t=n.current)==null||t.focus()},className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 text-slate-400 hover:text-red-500 transition-colors",children:e.jsx(c,{name:"X",size:14})})]})})]}),e.jsxs("div",{className:`flex-1 bg-white dark:bg-slate-900 rounded-2xl border ${B.borderClass.replace("border-","border-opacity-30 border-")} border-t-4 border-t-${B.borderClass.replace("border-","")} dark:border-slate-800 overflow-hidden shadow-sm relative flex flex-col transition-colors duration-500 ease-fluid`,children:[ee==="matrix"&&(p.length===0?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-400",children:[e.jsx("p",{className:"mb-4",children:"No processes defined."}),e.jsx("div",{className:"p-4 border-2 border-dashed border-indigo-200 dark:border-indigo-900/50 rounded-xl bg-indigo-50 dark:bg-indigo-900/10 text-indigo-500",children:"Create processes in the sidebar to begin planning."})]}):e.jsx("div",{className:"flex-1 overflow-auto custom-scrollbar relative",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:`${B.bgSoft.replace("50","50/80")} dark:bg-slate-950 sticky top-0 z-30 shadow-sm backdrop-blur-sm transition-colors duration-500 ease-fluid`,children:e.jsxs("tr",{children:[e.jsx("th",{className:`p-3 border-b border-r border-gray-200 dark:border-slate-800 sticky left-0 z-40 min-w-[300px] cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors group select-none ${B.bgSoft}`,onClick:Be,title:De?"Click to Expand All":"Click to Collapse All",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider transition-colors ${B.textClass}`,children:"Clause Reference"})})}),p.map(t=>e.jsx("th",{className:`p-3 text-[10px] font-bold uppercase tracking-wider border-b border-gray-200 dark:border-slate-800 min-w-[120px] text-center ${B.textClass}`,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"truncate max-w-[100px]",title:t.name,children:t.name}),e.jsx("span",{className:"text-[10px] font-bold bg-white dark:bg-slate-800 px-2 py-0.5 rounded-full shadow-sm",children:Object.keys(t.matrixData).length})]})},t.id))]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-slate-800/50",children:Ke.map(t=>{const s=y.has(t.id),l=Ie(t.id),r=_e(t.clauses);return e.jsxs(et.Fragment,{children:[e.jsxs("tr",{className:`sticky z-20 hover:brightness-95 transition-all duration-500 ease-fluid ${l}`,children:[e.jsx("td",{className:"p-2 border-r border-black/5 dark:border-white/5 font-black text-xs uppercase tracking-widest sticky left-0 z-20 bg-inherit shadow-sm cursor-pointer",onClick:()=>We(t.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{name:t.icon,size:14,className:"opacity-70"}),t.title]}),e.jsx(c,{name:"ChevronDown",size:14,className:`transition-transform duration-300 ${s?"-rotate-90":"rotate-0"}`})]})}),p.map(o=>{const i=[],D=b=>b.forEach(F=>{i.push(F.id),F.subClauses&&D(F.subClauses)});D(t.clauses);const u=p.find(b=>b.id===o.id),k=u?i.every(b=>!!u.matrixData[b]):!1;return e.jsx("td",{className:"p-2 text-center bg-inherit",children:!s&&e.jsx("button",{onClick:b=>Ue(b,o.id,t.clauses),className:"p-1.5 rounded-lg hover:bg-black/10 dark:hover:bg-white/10 transition-colors opacity-70 hover:opacity-100",title:k?"Deselect Group":"Select Entire Group",children:e.jsx(c,{name:k?"CheckSquare":"Square",size:16})})},`group_action_${o.id}_${t.id}`)})]}),!s&&r.map(({clause:o,level:i})=>e.jsx(ct,{clause:o,level:i,processes:p,onSmartToggle:Ge},o.id))]},t.id)})})]})})),ee==="resources"&&e.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[e.jsx(dt,{auditPlanConfig:M,setAuditPlanConfig:oe,auditSites:w,setAuditSites:q,auditTeam:_,setAuditTeam:T,processes:p,updateProcessCode:f,updateProcessSites:V,handleGenerateSchedule:qe,isGenerating:ce,genProgress:xe,genLogs:a,logsEndRef:h,handleRemoveDate:Xe,safeAuditDates:je,isCalendarOpen:te,setIsCalendarOpen:ue,handleUpdateDates:Ve}),e.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-900 relative flex flex-col overflow-hidden",children:[ce&&e.jsx("div",{className:"absolute inset-0 bg-white/95 dark:bg-slate-900/95 backdrop-blur-md z-50 flex flex-col items-center justify-center p-8 animate-in fade-in duration-300 rounded-2xl border border-white/20 dark:border-slate-800",children:e.jsxs("div",{className:"w-full max-w-lg space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-16 h-16 mb-4",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-orange-100 dark:border-slate-700 rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-t-4 border-orange-500 rounded-full animate-spin"}),e.jsx(c,{name:"Session7_Compass",className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-orange-500",size:24})]}),e.jsx("h3",{className:"text-xl font-black text-slate-800 dark:text-white animate-pulse",children:"Designing Audit Plan..."}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 font-mono mt-1",children:[xe,"% Complete"]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-orange-500 to-amber-500 transition-all duration-300 ease-out",style:{width:`${xe}%`}})}),e.jsxs("div",{className:"w-full h-40 bg-black/5 dark:bg-black/30 rounded-xl border border-gray-200 dark:border-slate-800 p-4 font-mono text-xs overflow-y-auto custom-scrollbar shadow-inner",children:[a.map((t,s)=>e.jsxs("div",{className:"mb-1 text-slate-600 dark:text-slate-400 flex gap-2",children:[e.jsx("span",{className:"text-orange-400 select-none",children:">"}),e.jsx("span",{children:t})]},s)),e.jsx("div",{ref:h})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6",children:J.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400",children:[e.jsx(c,{name:"Session7_Compass",size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-slate-500",children:"No Schedule Generated"}),e.jsx("p",{className:"text-xs mt-2",children:"Setup resources and click Generate."})]}):e.jsxs("div",{className:"space-y-8 pb-16",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(c,{name:"Session7_Compass",className:"text-orange-500"})," Audit Agenda"]})}),e.jsx("span",{className:"text-[10px] text-slate-400 italic",children:"Drag column headers to sort & group data"})]}),[...new Set(J.map(t=>Number(t.day)))].sort((t,s)=>t-s).map(t=>{var k;const s=J.filter(b=>b.day===t),l=((k=s[0])==null?void 0:k.date)||`Day ${t}`,r=Le(s),o=Pe(r,g),i=Fe(t),D=typeof i=="number"&&!isNaN(i)?i:0,u=D>8;return e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20 px-4 py-1.5 rounded-lg shadow-sm border border-orange-100 dark:border-orange-800/50",children:["Day ",t,": ",l]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 dark:bg-slate-800 px-3 py-1 rounded-full border border-gray-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-20 h-1.5 bg-gray-200 dark:bg-slate-600 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 ${u?"bg-red-500":"bg-emerald-500"}`,style:{width:`${Math.min(D/8*100,100)}%`}})}),e.jsxs("span",{className:`text-[10px] font-mono font-bold ${u?"text-red-500":"text-slate-500 dark:text-slate-400"}`,children:[D.toFixed(1),"/8h ",u&&"(Overload)"]})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-100 dark:border-slate-800 shadow-sm",children:e.jsxs("table",{className:"w-full border-collapse text-left bg-white dark:bg-slate-900",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50 dark:bg-slate-800/50 border-b border-gray-100 dark:border-slate-800 text-[10px] uppercase tracking-wider text-slate-500 select-none",children:g.map(b=>e.jsx("th",{className:"p-3 font-bold border-r border-gray-100 dark:border-slate-800 cursor-move hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors",draggable:!0,onDragStart:F=>ze(F,b),onDragOver:F=>Re(F,b),onDragEnd:Te,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{name:"Grid",size:10,className:"opacity-50"}),ke[b]||b]})},b))})}),e.jsx("tbody",{className:"text-xs divide-y divide-gray-100 dark:divide-slate-800/50",children:r.map((b,F)=>e.jsx("tr",{className:"hover:bg-orange-50/30 dark:hover:bg-slate-800/30 transition-colors",children:g.map((I,H)=>{const de=J.indexOf(b),Z=o[`${F}_${H}`];return Z===0?null:e.jsxs("td",{rowSpan:Z,className:"p-3 border-r border-gray-100 dark:border-slate-800 align-top bg-white dark:bg-slate-900",children:[I==="timeSlot"&&e.jsxs("div",{className:"group/time cursor-pointer flex items-center gap-2 hover:bg-gray-50 dark:hover:bg-slate-800 p-1.5 rounded-lg transition-colors border border-transparent hover:border-gray-200 dark:hover:border-slate-700",onClick:()=>me({rowIndex:de,item:b}),title:"Click to Reschedule Activity",children:[e.jsx("span",{className:"font-mono font-bold text-slate-600 dark:text-slate-400 group-hover/time:text-orange-600 dark:group-hover/time:text-orange-400",children:b.timeSlot}),e.jsx(c,{name:"Calendar",size:12,className:"opacity-0 group-hover/time:opacity-100 text-orange-400 transition-opacity"})]}),I==="siteName"&&e.jsx("span",{className:"text-slate-500",children:b.siteName}),I==="auditorName"&&e.jsxs("div",{className:"group/auditor cursor-pointer flex items-center gap-2 hover:bg-gray-50 dark:hover:bg-slate-800 p-1.5 rounded-lg transition-colors border border-transparent hover:border-gray-200 dark:hover:border-slate-700",onClick:()=>be({rowIndex:de,currentName:b.auditorName}),title:"Click to reassign auditor",children:[e.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-300 group-hover/auditor:text-indigo-600 dark:group-hover/auditor:text-indigo-400",children:b.auditorName}),b.isRemote&&e.jsx("span",{className:"text-[8px] bg-purple-100 text-purple-600 px-1 rounded",children:"R"}),e.jsx(c,{name:"Users",size:12,className:"opacity-0 group-hover/auditor:opacity-100 text-indigo-400 transition-opacity"})]}),I==="processName"&&e.jsxs("div",{className:"font-bold text-indigo-600 dark:text-indigo-400 flex items-center gap-1",children:[e.jsx(c,{name:"Session11_GridAdd",size:12})," ",b.processName||"General"]}),I==="activity"&&e.jsx("div",{className:"font-bold text-slate-800 dark:text-slate-200 whitespace-pre-wrap leading-tight",children:b.activity}),I==="clauseRefs"&&(b.clauseRefs&&b.clauseRefs.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:b.clauseRefs.map(P=>e.jsx("span",{className:"bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 px-1.5 py-0.5 rounded text-[9px] font-mono text-slate-600 dark:text-slate-400",children:P},P))}):e.jsx("span",{className:"text-slate-300 text-[10px]",children:"-"}))]},I)})},F))})]})})]},t)})]})}),J.length>0&&e.jsx("div",{className:"flex-none p-4 border-t border-gray-100 dark:border-slate-800 bg-white dark:bg-slate-900 z-10 flex justify-end gap-2 shadow-inner",children:e.jsxs("button",{onClick:()=>d&&d("schedule",W,"docx",{columns:g,customHeader:Q}),className:"px-4 h-[40px] bg-blue-600 hover:bg-blue-700 text-white rounded-xl text-xs font-bold flex items-center justify-center gap-2 transition-all duration-300 active:scale-95 shadow-lg whitespace-nowrap",children:[e.jsx(c,{name:"Download"}),e.jsx("span",{className:"hidden md:inline",children:"Export"}),e.jsxs("div",{className:"lang-pill-container ml-1",children:[e.jsx("span",{onClick:t=>{t.stopPropagation(),S("en")},className:`lang-pill-btn ${W==="en"?"lang-pill-active":"lang-pill-inactive"}`,children:"EN"}),e.jsx("span",{onClick:t=>{t.stopPropagation(),S("vi")},className:`lang-pill-btn ${W==="vi"?"lang-pill-active":"lang-pill-inactive"}`,children:"VI"})]})]})})]})]})]}),e.jsx($e,{isOpen:!!U,title:"Select Auditor for this Activity",onClose:()=>be(null),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-xl border border-indigo-100 dark:border-indigo-800",children:[e.jsx("span",{className:"text-xs text-indigo-800 dark:text-indigo-300 font-bold uppercase tracking-wider",children:"Current Assignment"}),e.jsx("span",{className:"font-black text-sm text-indigo-700 dark:text-indigo-200",children:U==null?void 0:U.currentName})]}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto custom-scrollbar border border-gray-100 dark:border-slate-800 rounded-xl shadow-inner bg-white dark:bg-slate-900",children:_.map(t=>e.jsxs("div",{className:`p-4 flex items-start gap-3 cursor-pointer transition-all border-b border-gray-100 dark:border-slate-800 last:border-0 hover:bg-gray-50 dark:hover:bg-slate-800/80 ${(U==null?void 0:U.currentName)===t.name?"bg-indigo-50/50 dark:bg-indigo-900/10":""}`,onClick:()=>{U&&(Se(U.rowIndex,"auditorName",t.name),Se(U.rowIndex,"isRemote",t.isRemote),be(null))},children:[e.jsx("div",{className:`mt-1 w-3 h-3 rounded-full flex-shrink-0 ${(U==null?void 0:U.currentName)===t.name?"bg-emerald-500 shadow-sm":"border border-slate-300 dark:border-slate-600"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("div",{className:"font-bold text-sm text-slate-800 dark:text-slate-200 truncate pr-2",children:t.name}),e.jsxs("div",{className:"text-[10px] font-mono text-slate-400 shrink-0 bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded",children:[t.manDays," WD"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 items-center mb-1.5",children:[e.jsx("span",{className:"text-[9px] bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 px-1.5 py-0.5 rounded font-bold uppercase tracking-wide",children:t.role}),t.competencyCodes&&e.jsxs("span",{className:"text-[9px] bg-teal-50 dark:bg-teal-900/30 text-teal-700 dark:text-teal-400 border border-teal-100 dark:border-teal-800 px-1.5 py-0.5 rounded font-mono font-bold flex items-center gap-1",title:"Technical Competency Codes",children:[e.jsx(c,{name:"Tag",size:8})," ",t.competencyCodes]}),t.isRemote&&e.jsx("span",{className:"text-[9px] bg-purple-100 text-purple-700 px-1.5 py-0.5 rounded font-bold",children:"REMOTE"})]}),t.availability&&e.jsxs("div",{className:"text-[10px] text-amber-700 dark:text-amber-400 bg-amber-50 dark:bg-amber-900/20 px-2 py-1.5 rounded-lg border border-amber-100 dark:border-amber-800/50 italic flex items-start gap-1.5 leading-snug",children:[e.jsx(c,{name:"Info",size:10,className:"mt-0.5 shrink-0 opacity-70"}),t.availability]})]})]},t.id))})]})}),e.jsx(it,{isOpen:!!le,onClose:()=>me(null),targetItem:le==null?void 0:le.item,availableDates:je,onSave:Oe})]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400 bg-gray-50/30 dark:bg-slate-900/30 rounded-2xl border border-dashed border-gray-200 dark:border-slate-800 m-4 animate-fade-in-up",children:[e.jsx(c,{name:"Book",size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"font-bold text-slate-500",children:"No Standard Selected"}),e.jsxs("button",{onClick:Je,className:"mt-6 px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow-lg text-xs font-bold flex items-center gap-2",children:[e.jsx(c,{name:"LayoutList",size:16})," Select Standard"]})]})};export{gt as PlanningView};
