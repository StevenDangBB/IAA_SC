import{r as c,j as e}from"./vendor-react--UE8qFvL.js";import{a as ae,d as se,u as le,T as ie,I as n,p as ne,e as de}from"./index-DfzK5TSP.js";import"./vendor-BhE6lIor.js";import"./vendor-genai-C0GBL7S7.js";const ue=({analysisResult:i,setAnalysisResult:S,selectedFindings:h,setSelectedFindings:O,isAnalyzeLoading:z,loadingMessage:G,currentAnalyzingClause:_,viewMode:b,setViewMode:M,focusedFindingIndex:f,setFocusedFindingIndex:J,onExport:q,notesLanguage:w,setNotesLanguage:$})=>{const v=c.useRef(null),N=c.useRef([]),{getActiveKey:P}=ae(),{showToast:u}=se(),{standards:E,standardKey:y,privacySettings:K}=le(),[V,F]=c.useState(null),[U,B]=c.useState({}),[W,R]=c.useState(null),[H,Y]=c.useState(new Set),[k,Q]=c.useState(!1),C=ie.find(t=>t.id==="findings");c.useEffect(()=>{b==="list"&&v.current&&(v.current.scrollTop=v.current.scrollHeight)},[i==null?void 0:i.length,b]);const j=c.useMemo(()=>!i||i.length===0?!1:i.every(t=>h[t.clauseId]),[i,h]),T=c.useMemo(()=>{if(!i)return{};const t={};return i.forEach((r,a)=>{const l=r.processName||"General Audit";t[l]||(t[l]=[]),t[l].push({finding:r,originalIndex:a})}),Object.keys(t).sort().reduce((r,a)=>(r[a]=t[a],r),{})},[i]),X=t=>{Y(r=>{const a=new Set(r);return a.has(t)?a.delete(t):a.add(t),a})},Z=()=>{if(!i)return;const t={},r=!j;i.forEach(a=>{t[a.clauseId]=r}),O(a=>({...a,...t})),u(r?"All Findings Selected":"All Findings Deselected")},I=(t,r,a)=>{if(S(l=>{if(!l)return null;const d=[...l];return d[t]={...d[t],[r]:a},d}),r==="status"&&i){const l=t+1;l<i.length&&N.current[l]&&setTimeout(()=>{var d;return(d=N.current[l])==null?void 0:d.scrollIntoView({behavior:"smooth",block:"center"})},100)}},ee=async(t,r)=>{t.stopPropagation();const a=P();if(!a)return u("API Key Required for Review");F(r.clauseId);try{const l=await ne(r,a.key,a.activeModel);B(d=>({...d,[r.clauseId]:l}))}catch{u("Review Failed")}finally{F(null)}},te=async(t,r)=>{const a=P();if(!a)return u("API Key Required");if(!y||!E[y])return u("Standard context missing");R(r.clauseId);try{const l=E[y],o=(m=>{const p=A=>{for(const g of A){if(g.id===m||g.code===m)return g;if(g.subClauses){const D=p(g.subClauses);if(D)return D}}return null};for(const A of l.groups){const g=p(A.clauses);if(g)return g}return null})(r.clauseId);if(!o)throw new Error("Clause definition not found");const x=await de({code:o.code,title:o.title,description:o.description},l.name,r.evidence,"",a.key,a.activeModel,K.maskCompany),s=JSON.parse(x);S(m=>{if(!m)return null;const p=[...m];return p[t]={...p[t],status:s.status,reason:s.reason,suggestion:s.suggestion,conclusion_report:s.conclusion_report},p}),u("Finding Re-evaluated Successfully")}catch(l){console.error(l),u("Re-evaluation Failed: "+l.message)}finally{R(null)}},re=t=>{switch(t){case"COMPLIANT":return{bg:"bg-emerald-500",text:"text-emerald-700 dark:text-emerald-300",pill:"bg-emerald-100 dark:bg-emerald-900/40 text-emerald-700 dark:text-emerald-300",border:"border-emerald-500"};case"NC_MAJOR":return{bg:"bg-red-600",text:"text-red-700 dark:text-red-300",pill:"bg-red-100 dark:bg-red-900/40 text-red-700 dark:text-red-300",border:"border-red-600"};case"NC_MINOR":return{bg:"bg-orange-500",text:"text-orange-700 dark:text-orange-300",pill:"bg-orange-100 dark:bg-orange-900/40 text-orange-700 dark:text-orange-400",border:"border-orange-500"};case"OFI":return{bg:"bg-blue-500",text:"text-blue-700 dark:text-blue-300",pill:"bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300",border:"border-blue-500"};default:return{bg:"bg-slate-500",text:"text-slate-600",pill:"bg-slate-100 text-slate-500",border:"border-slate-300"}}},L=(t,r,a=!1)=>{const l=re(t.status),d=U[t.clauseId],o=V===t.clauseId,x=W===t.clauseId;return e.jsxs("div",{ref:a?null:s=>{N.current[r]=s},className:`group relative bg-white dark:bg-slate-900 rounded-2xl p-4 md:p-5 border-l-[6px] transition-all duration-300 hover:shadow-depth-lg dark:shadow-[0_0_0_1px_rgba(255,255,255,0.05)] ${l.border} ${h[t.clauseId]?"ring-2 ring-indigo-500/20 translate-x-2":"hover:translate-x-1 opacity-60 hover:opacity-100"} animate-in slide-in-from-bottom-2 fade-in fill-mode-backwards`,style:{animationDelay:`${r*50}ms`},onClick:()=>O(s=>({...s,[t.clauseId]:!s[t.clauseId]})),children:[e.jsxs("div",{className:"absolute top-4 right-4 z-10 flex gap-2",children:[e.jsx("button",{onClick:s=>ee(s,t),disabled:o,className:`p-1.5 rounded-full transition-all border ${d?"bg-purple-100 text-purple-600 border-purple-200":"bg-gray-100 text-slate-400 hover:text-purple-600 hover:bg-purple-50 border-transparent"}`,title:"AI Shadow Review (Critique Finding)",children:o?e.jsx(n,{name:"Loader",className:"animate-spin",size:14}):e.jsx(n,{name:"ShieldEye",size:14})}),h[t.clauseId]?e.jsx("div",{className:"bg-emerald-100 dark:bg-emerald-900/30 rounded-full p-1 text-emerald-600 dark:text-emerald-400",children:e.jsx(n,{name:"CheckThick",size:18})}):e.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-gray-200 dark:border-slate-700 group-hover:border-indigo-400 transition-colors"})]}),e.jsxs("div",{className:"pr-12",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 flex-wrap",children:[e.jsx("span",{className:"text-xs font-black text-slate-500 dark:text-slate-400 bg-gray-100 dark:bg-slate-800 px-2 py-1 rounded-lg border border-gray-200 dark:border-slate-700",children:t.clauseId}),t.processName&&e.jsxs("span",{className:"text-[10px] font-bold text-indigo-600 dark:text-indigo-400 bg-indigo-50 dark:bg-indigo-900/30 px-2 py-1 rounded border border-indigo-100 dark:border-indigo-800 flex items-center gap-1",children:[e.jsx(n,{name:"Session11_GridAdd",size:10})," ",t.processName]}),e.jsx("div",{className:"relative group/badge",onClick:s=>s.stopPropagation(),children:e.jsxs("select",{value:t.status,onChange:s=>I(r,"status",s.target.value),className:`appearance-none cursor-pointer text-[10px] font-black uppercase tracking-wider px-3 py-1 rounded-full ${l.pill} border-none outline-none hover:brightness-95 text-center transition-all shadow-sm`,children:[e.jsx("option",{className:"bg-white dark:bg-slate-900 text-slate-900 dark:text-white",value:"COMPLIANT",children:"COMPLIANT"}),e.jsx("option",{className:"bg-white dark:bg-slate-900 text-slate-900 dark:text-white",value:"NC_MINOR",children:"MINOR NC"}),e.jsx("option",{className:"bg-white dark:bg-slate-900 text-slate-900 dark:text-white",value:"NC_MAJOR",children:"MAJOR NC"}),e.jsx("option",{className:"bg-white dark:bg-slate-900 text-slate-900 dark:text-white",value:"OFI",children:"OFI"})]})})]}),e.jsxs("div",{className:"mb-4 group/evidence relative",children:[x&&e.jsx("div",{className:"absolute inset-0 z-20 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm rounded-xl flex items-center justify-center border border-indigo-100 dark:border-indigo-900",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(n,{name:"Loader",className:"animate-spin text-indigo-500 mb-2",size:24}),e.jsx("span",{className:"text-xs font-bold text-indigo-600 dark:text-indigo-400 animate-pulse",children:"Re-evaluating based on updates..."})]})}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-950/50 p-4 rounded-xl border border-slate-100 dark:border-slate-800 relative transition-colors focus-within:border-indigo-300 dark:focus-within:border-indigo-700 focus-within:ring-1 focus-within:ring-indigo-500/20",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("strong",{className:"text-[10px] font-bold text-indigo-600 dark:text-indigo-400 uppercase tracking-wider block",children:"Verified Evidence"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[9px] text-slate-400 opacity-0 group-hover/evidence:opacity-100 transition-opacity flex items-center gap-1",children:[e.jsx(n,{name:"FileEdit",size:10})," Editable"]}),e.jsxs("button",{onClick:s=>{s.stopPropagation(),te(r,t)},className:"px-2 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300 rounded text-[9px] font-bold hover:bg-indigo-200 dark:hover:bg-indigo-800 transition-colors flex items-center gap-1 opacity-0 group-hover/evidence:opacity-100 focus:opacity-100",title:"Re-run AI Analysis for ONLY this clause based on updated evidence",children:[e.jsx(n,{name:"RefreshCw",size:10})," Re-evaluate Finding"]})]})]}),e.jsx("textarea",{value:t.evidence,onChange:s=>I(r,"evidence",s.target.value),className:"w-full bg-transparent outline-none text-sm text-slate-700 dark:text-slate-300 leading-relaxed font-medium resize-y min-h-[80px] whitespace-pre-wrap font-mono custom-scrollbar border-l-2 border-transparent focus:border-indigo-400 pl-2 transition-all",placeholder:"Evidence content...",spellCheck:!1,disabled:x})]})]}),e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border-2 border-slate-100 dark:border-slate-800 hover:border-indigo-200 dark:hover:border-indigo-900/50 transition-colors group-focus-within:border-indigo-500 shadow-sm",onClick:s=>s.stopPropagation(),children:[e.jsx("strong",{className:"text-[10px] font-bold text-purple-600 dark:text-purple-400 uppercase tracking-wider mb-1 block",children:"Auditor Conclusion"}),x?e.jsx("div",{className:"h-[60px] w-full bg-slate-50 dark:bg-slate-800 animate-pulse rounded"}):e.jsx("textarea",{value:t.reason,onChange:s=>I(r,"reason",s.target.value),className:"w-full bg-transparent outline-none text-base text-slate-800 dark:text-slate-200 leading-relaxed resize-none h-auto min-h-[60px]",placeholder:"Enter conclusion..."})]})}),d&&e.jsxs("div",{className:"mt-3 p-3 bg-purple-50 dark:bg-purple-900/20 border-l-4 border-purple-400 rounded-r-lg animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(n,{name:"ShieldEye",size:12,className:"text-purple-600"}),e.jsx("span",{className:"text-[10px] font-bold text-purple-700 dark:text-purple-300 uppercase",children:"AI Reviewer Note"})]}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 italic leading-relaxed",children:['"',d,'"']})]}),t.suggestion&&!d&&e.jsxs("div",{className:"flex gap-2 items-start mt-3 opacity-80 group-hover:opacity-100 transition-opacity",children:[e.jsx("div",{className:"p-1 bg-amber-100 dark:bg-amber-900/30 rounded-full text-amber-600 dark:text-amber-400 shrink-0",children:e.jsx(n,{name:"Lightbulb",size:10})}),e.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400 italic leading-tight pt-0.5",children:t.suggestion})]})]})]},r)};return e.jsxs("div",{className:"h-full flex flex-col gap-2 md:gap-4 animate-fade-in-up",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-1",ref:v,children:[!i&&!z&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-400 opacity-60",children:[e.jsx("div",{className:"p-6 bg-slate-100 dark:bg-slate-800 rounded-full mb-4 animate-pulse-slow",children:e.jsx(n,{name:"Wand2",size:48,className:"text-indigo-300 dark:text-indigo-600"})}),e.jsx("p",{className:"font-bold",children:"No analysis results yet."}),e.jsx("p",{className:"text-xs mt-2",children:"Run analysis from the Audit tab to generate findings."})]}),z&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"relative w-28 h-28 mb-8",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-indigo-100 dark:border-indigo-900/50 rounded-full opacity-50"}),e.jsx("div",{className:"absolute inset-0 border-t-4 border-indigo-500 rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-4 border-r-4 border-purple-500 rounded-full animate-spin-reverse opacity-70"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(n,{name:"BrainCircuit",size:32,className:"text-indigo-500 animate-pulse"})})]}),e.jsx("h3",{className:"text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 to-purple-500 animate-pulse mb-3",children:"AI Auditor Working"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 font-medium mb-1 bg-white/50 dark:bg-slate-800/50 px-4 py-1 rounded-full shadow-sm",children:G}),e.jsx("p",{className:"text-xs text-slate-400 font-mono mt-2 opacity-80",children:_&&`Analyzing Clause: [${_}]`})]}),i&&(b==="list"?e.jsx("div",{className:"space-y-4 pb-10",children:i.map((t,r)=>L(t,r))}):e.jsxs("div",{className:"flex flex-col h-full gap-4",children:[e.jsxs("div",{className:`flex-shrink-0 flex flex-col bg-white dark:bg-slate-900 rounded-2xl border ${C.borderClass.replace("border-","border-opacity-30 border-")} border-t-4 border-t-${C.borderClass.replace("border-","")} dark:border-slate-800 overflow-hidden shadow-depth transition-all duration-300 ease-in-out ${k?"h-11 min-h-[44px]":"h-auto max-h-[45vh]"}`,children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-white/50 dark:bg-slate-900/50 border-b border-gray-50 dark:border-slate-800 cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-800",onClick:()=>Q(!k),children:[e.jsxs("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(n,{name:"Grid",size:12})," Findings Matrix (",Object.keys(T).length," Processes)"]}),e.jsx("div",{className:"text-slate-400 hover:text-indigo-500 transition-colors",children:e.jsx(n,{name:k?"ChevronDown":"ChevronUp",size:16})})]}),e.jsxs("div",{className:`flex flex-col transition-opacity duration-200 ${k?"opacity-0 pointer-events-none":"opacity-100"}`,children:[e.jsxs("div",{className:`grid grid-cols-[80px_1fr_1fr_1fr_1fr] gap-1 p-3 border-b border-gray-100 dark:border-slate-800 ${C.bgSoft} sticky top-0 z-10 transition-colors duration-500 ease-fluid`,children:[e.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest text-center",children:"Clause"}),e.jsx("div",{className:"text-[10px] font-bold text-red-500 uppercase tracking-widest text-center",children:"Major"}),e.jsx("div",{className:"text-[10px] font-bold text-orange-500 uppercase tracking-widest text-center",children:"Minor"}),e.jsx("div",{className:"text-[10px] font-bold text-blue-500 uppercase tracking-widest text-center",children:"OFI"}),e.jsx("div",{className:"text-[10px] font-bold text-emerald-500 uppercase tracking-widest text-center",children:"Comp"})]}),e.jsx("div",{className:"overflow-y-auto custom-scrollbar max-h-[40vh] p-2",children:Object.entries(T).map(([t,r])=>{const a=H.has(t),l=r,d=l.filter(o=>o.finding.status==="NC_MAJOR"||o.finding.status==="NC_MINOR").length;return e.jsxs("div",{className:"flex flex-col mb-2 rounded-xl border border-gray-100 dark:border-slate-800 bg-gray-50/50 dark:bg-slate-900/50 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-white dark:bg-slate-900 cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors",onClick:()=>X(t),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{name:"ChevronDown",size:14,className:`text-slate-400 transition-transform duration-300 ${a?"-rotate-90":""}`}),e.jsx("span",{className:"text-xs font-bold text-indigo-600 dark:text-indigo-300 uppercase tracking-wide truncate max-w-[200px]",title:t,children:t}),e.jsxs("span",{className:"text-[10px] text-slate-400 font-normal",children:["(",l.length,")"]})]}),d>0&&e.jsxs("span",{className:"text-[9px] font-bold text-red-500 bg-red-50 dark:bg-red-900/20 px-2 py-0.5 rounded shadow-sm",children:[d," NCs"]})]}),!a&&e.jsx("div",{className:"max-h-[240px] overflow-y-auto custom-scrollbar divide-y divide-gray-100 dark:divide-slate-800/50 border-t border-gray-100 dark:border-slate-800",children:l.map(({finding:o,originalIndex:x})=>{const s=f===x;return e.jsxs("div",{onClick:()=>J(x),className:`grid grid-cols-[80px_1fr_1fr_1fr_1fr] gap-1 py-2 cursor-pointer transition-colors ${s?"bg-indigo-50 dark:bg-indigo-900/20":"hover:bg-slate-100 dark:hover:bg-slate-800/80"}`,children:[e.jsx("div",{className:`flex items-center justify-center h-full w-full text-[10px] font-mono font-bold ${s?"text-indigo-600 dark:text-indigo-400":"text-slate-500 dark:text-slate-400"}`,children:o.clauseId}),e.jsx("div",{className:"flex items-center justify-center h-full w-full",children:o.status==="NC_MAJOR"&&e.jsx("div",{className:"w-4 h-4 rounded bg-red-500 shadow-md ring-2 ring-white dark:ring-slate-900",title:"Major NC"})}),e.jsx("div",{className:"flex items-center justify-center h-full w-full",children:o.status==="NC_MINOR"&&e.jsx("div",{className:"w-4 h-4 rounded bg-orange-500 shadow-md ring-2 ring-white dark:ring-slate-900",title:"Minor NC"})}),e.jsx("div",{className:"flex items-center justify-center h-full w-full",children:o.status==="OFI"&&e.jsx("div",{className:"w-4 h-4 rounded bg-blue-500 shadow-md ring-2 ring-white dark:ring-slate-900",title:"Opportunity for Improvement"})}),e.jsx("div",{className:"flex items-center justify-center h-full w-full",children:o.status==="COMPLIANT"&&e.jsx("div",{className:"w-4 h-4 rounded bg-emerald-500 shadow-md ring-2 ring-white dark:ring-slate-900",title:"Compliant"})})]},x)})})]},t)})})]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto custom-scrollbar bg-slate-50/50 dark:bg-slate-900/50 rounded-2xl border border-gray-100 dark:border-slate-800 p-2 shadow-inner",children:i[f]?L(i[f],f,!0):e.jsx("div",{className:"h-full flex items-center justify-center text-slate-400 italic text-xs",children:"Select a row above to view details"})})]}))]}),e.jsxs("div",{className:"flex-shrink-0 flex flex-row items-center md:justify-end gap-2 md:gap-3 w-full pt-2",children:[e.jsxs("div",{className:"flex-1 md:flex-none md:w-auto h-[52px] bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 rounded-xl p-1 flex items-center shadow-sm min-w-0 dark:shadow-md",children:[e.jsxs("button",{onClick:()=>M("list"),className:`flex-1 md:flex-none md:w-auto h-full px-4 rounded-lg flex items-center justify-center gap-2 transition-all whitespace-nowrap ${b==="list"?"bg-indigo-500 text-white shadow-md":"text-slate-400 hover:text-slate-600 hover:bg-gray-50 dark:hover:bg-slate-800"}`,title:"List View",children:[e.jsx(n,{name:"LayoutList",size:18}),e.jsx("span",{className:"hidden md:inline text-xs font-bold",children:"List"})]}),e.jsxs("button",{onClick:()=>M("matrix"),className:`flex-1 md:flex-none md:w-auto h-full px-4 rounded-lg flex items-center justify-center gap-2 transition-all whitespace-nowrap ${b==="matrix"?"bg-indigo-500 text-white shadow-md":"text-slate-400 hover:text-slate-600 hover:bg-gray-50 dark:hover:bg-slate-800"}`,title:"Matrix View",children:[e.jsx(n,{name:"Grid",size:18}),e.jsx("span",{className:"hidden md:inline text-xs font-bold",children:"Matrix"})]})]}),i&&e.jsxs("button",{onClick:Z,className:`flex-none md:w-auto px-4 h-[52px] border rounded-xl text-xs font-bold flex items-center justify-center gap-2 transition-all duration-300 active:scale-95 shadow-sm whitespace-nowrap dark:shadow-md ${j?"bg-indigo-50 border-indigo-200 text-indigo-600 dark:bg-indigo-900/20 dark:border-indigo-800 dark:text-indigo-400":"bg-white dark:bg-slate-900 border-gray-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:bg-gray-50"}`,children:[e.jsx(n,{name:j?"CheckSquare":"Square",size:18}),e.jsx("span",{className:"hidden lg:inline",children:j?"Deselect All":"Select All"})]}),e.jsxs("button",{onClick:()=>q("notes",w),disabled:!i,className:"flex-none md:w-auto px-6 h-[52px] bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 hover:border-indigo-500 text-slate-700 dark:text-slate-200 rounded-xl text-xs font-bold flex items-center justify-center gap-2 transition-all duration-300 active:scale-95 shadow-sm disabled:opacity-50 whitespace-nowrap dark:shadow-md hover:shadow-lg",children:[e.jsx(n,{name:"Download"}),e.jsx("span",{className:"hidden md:inline",children:"Export Findings"}),e.jsxs("div",{className:"lang-pill-container",children:[e.jsx("span",{onClick:t=>{t.stopPropagation(),$("en")},className:`lang-pill-btn ${w==="en"?"lang-pill-active":"lang-pill-inactive"}`,children:"EN"}),e.jsx("span",{onClick:t=>{t.stopPropagation(),$("vi")},className:`lang-pill-btn ${w==="vi"?"lang-pill-active":"lang-pill-inactive"}`,children:"VI"})]})]})]})]})};export{ue as FindingsView};
